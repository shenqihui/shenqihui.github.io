<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[神奇辉]]></title>
  <subtitle><![CDATA[吾十有五而志于养猪，三十始养，四十亏本，五十再亏，六十亏大了，七十卒，不逾矩。现廿五，将卒。]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://shenqihui.github.io/"/>
  <updated>2015-03-12T05:51:42.000Z</updated>
  <id>http://shenqihui.github.io/</id>
  
  <author>
    <name><![CDATA[神奇辉]]></name>
    <email><![CDATA[c2hlbnFpaHVpMDkyMEBnbWFpbC5jb20K]]></email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[javascript 函数劫持]]></title>
    <link href="http://shenqihui.github.io/2015/02/12/the-Italian-job-hijacked-the-javascript-function/"/>
    <id>http://shenqihui.github.io/2015/02/12/the-Italian-job-hijacked-the-javascript-function/</id>
    <published>2015-02-11T16:38:04.000Z</published>
    <updated>2015-03-12T05:51:42.000Z</updated>
    <content type="html"><![CDATA[<p>最近在搞坏事，因此总会有一些很猥琐很猥琐的想法。<br>具体有多少，只有你想不到，没有做不到。<br>这里就来讲讲如何在 js 层面，神不知鬼不觉的劫持函数。</p>
<a id="more"></a>
<h2 id="函数劫持是什么？">函数劫持是什么？</h2><p>这里所说的函数劫持，是在不改变原有功能的前提下，注入自己想要的功能。<br>改变原有功能的劫持方式简单粗暴，这里不推荐这种想法。<br>我们要做的，就是天知地知你知我知其他人不知。  </p>
<h2 id="函数劫持能干什么？">函数劫持能干什么？</h2><p>首先你得明白为什么要劫持。<br>一旦你明白了为什么要劫持，就需要找劫持点，进行函数重写劫持。<br>具体在这个重写之后的函数增加什么功能，就看你为什么要劫持了。<br>函数劫持了，你想干什么，就能干什么。</p>
<h2 id="劫持的原理">劫持的原理</h2><p>一般的劫持原理都是一个思路：<br>一、使用新的变量保存即将被劫持的函数。<br>二、改写被劫持函数的功能。<br>三、在被劫持函数的末尾段（或者其他适当部位）重新调用重写之前的函数。  </p>
<h2 id="如何进行劫持">如何进行劫持</h2><p>先来看看下面这段代码。  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// save old ajax</span></span><br><span class="line">$._ajax = $.ajax;</span><br><span class="line"><span class="comment">// incase something.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noop</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// 我想要加入的功能</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunctionToHack</span><span class="params">(data)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">  <span class="comment">// do something you want</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// accord $.ajax to change</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajaxHacker</span><span class="params">(e, n)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// old success function</span></span><br><span class="line">  e._success = e.success || noop;</span><br><span class="line">  <span class="comment">// new success function of lucky money</span></span><br><span class="line">  e.success = <span class="function"><span class="keyword">function</span> <span class="title">success</span><span class="params">(data)</span> </span>&#123;</span><br><span class="line">    myFunctionToHack(data);</span><br><span class="line"></span><br><span class="line">    e._success.call(<span class="keyword">this</span>, data);</span><br><span class="line">    </span><br><span class="line">  &#125;;</span><br><span class="line">  $._ajax(e, n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// change default ajax</span></span><br><span class="line">$.ajax = ajaxHacker;</span><br></pre></td></tr></table></figure>
<p>这段代码的作用估计大家都一目了然。<br>主要的功能就是重写 jquery 的 ajax 请求函数，在原生的 ajax 功能的基础上，劫持 success 回调功能。</p>
<p>具体劫持方式：</p>
<h3 id="使用新的变量保存即将被劫持的函数">使用新的变量保存即将被劫持的函数</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$.</span><span class="constant">_ajax </span>= <span class="variable">$.</span>ajax;  </span><br><span class="line">e.<span class="constant">_success </span>= e.success || noop;</span><br></pre></td></tr></table></figure>
<p>保存旧方法方便调用。</p>
<h3 id="改写被劫持函数的功能">改写被劫持函数的功能</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$.ajax = ajaxHacker;</span><br><span class="line">e.success = <span class="keyword">function</span> success(data) &#123;</span><br><span class="line">  // <span class="keyword">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>把 <code>jquery</code> 的 <code>ajax</code> 替换为 <code>ajaxHacker</code> 函数，实现就功能的改写。</p>
<h3 id="在被劫持函数的末尾段重新调用重写之前的函数">在被劫持函数的末尾段重新调用重写之前的函数</h3><p>为了保持功能与原来的基本一致，需要重新调用原来的函数。<br>一般情况下面都是在处理完毕自己想要的功能之后调用。这些都看个人习惯进行。<br>由于上面的代码有两个函数劫持，所以分开来讲：  </p>
<p>先看一个简单的： </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> ajaxHacker(e, n) &#123;</span><br><span class="line">  // <span class="keyword">...</span></span><br><span class="line">  </span><br><span class="line">  $._ajax(e, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个时候，旧的 <code>jquery</code> <code>ajax</code> 功能就能在 <code>ajaxHacker</code> 执行末尾调用，<br>中途就能增加自己想要的功能了。</p>
<p>复杂点的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">e.success = <span class="keyword">function</span> success(data) &#123;</span><br><span class="line">  // <span class="keyword">...</span></span><br><span class="line">  myFunctionToHack(data);</span><br><span class="line"></span><br><span class="line">  e._success.call(this, data);</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>success</code> 回调函数保存在 <code>e._success</code> 里面，重写了 <code>success</code> 功能之后，重新调用 <code>e._success</code>。<br>但是这个时候使用了 <code>call</code> 进行调用，原因就是避免函数运行环境 <code>this</code> 对象变化了。使用 <code>call</code> 能够确保劫持之前的运行上下文与劫持之后的运行上下文一致。<br>当然如果 <code>this</code> 对象没被使用的话，不使用 <code>call</code> 也是可以的，  </p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">e</span>._success(<span class="typedef"><span class="keyword">data</span>);</span></span><br></pre></td></tr></table></figure>
<p>这样子调用，也行。</p>
<p>另外也可以使用 <code>apply</code> 代替 <code>call</code> ，两者都能操控 <code>this</code> 。</p>
<p>PS: 第二个例子，不使用 <code>call</code> 其 <code>this</code> 对象也是 <code>e</code>。因为使用了命名空间的方式进行了调用。如果不是使用 <code>e._success</code> 而是使用 <code>_success</code> 保存就函数，就必须使用 <code>call</code> 或者 <code>apply</code> 来确保运行上下文正确。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>最近在搞坏事，因此总会有一些很猥琐很猥琐的想法。<br>具体有多少，只有你想不到，没有做不到。<br>这里就来讲讲如何在 js 层面，神不知鬼不觉的劫持函数。</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[Git 最佳实践]]></title>
    <link href="http://shenqihui.github.io/2015/01/29/best-practices-of-git/"/>
    <id>http://shenqihui.github.io/2015/01/29/best-practices-of-git/</id>
    <published>2015-01-29T15:11:00.000Z</published>
    <updated>2015-03-12T05:50:26.000Z</updated>
    <content type="html"><![CDATA[<p>今天一个朋友在他们的 git 工作流上面遇到问题了。来询问我关于我们团队是如何使用 git 进行团队协作的。 然后我就秉着技术分享的思想给他们讲解。特意写下此文。git 这东西，用得好就是好东西。用得不好，那就只能怪你没下功夫去用了。骚年，勇敢的用起来吧。  </p>
<a id="more"></a>
<h2 id="前言">前言</h2><p>怎么使用 git， 为啥使用 git， 如何使用 git， git 和 svn 或者 hg 哪个好，就不说了，个人还是觉得 git 好。如果你觉得意见不同，来打我啊。<br>本文提到的项目是网站类型的，迭代比较快，所以一旦有功能完成就即刻发布。  </p>
<h2 id="我们的使用场景">我们的使用场景</h2><p>项目是一个网站，开发团队 n(n&gt;3)人。使用的时内部的 git 仓库。  </p>
<h2 id="仓库规范">仓库规范</h2><p>项目发起由项目组组织（organization）发起，每个项目成员进行仓库的 fork 操作，不允许 push 代码至非自己所有的远程仓库。  </p>
<h2 id="分支规范">分支规范</h2><p>每个人都进行了仓库的 fork 操作，因此每个人的仓库（下称 origin ）分支就自由发挥了。主要讲讲主仓库（下称 upstream ）的分支规范。<br>主仓库主要存在两个分支，master + dev 分支，具体名字可以随便，能理解就好。</p>
<h3 id="dev_分支的功能">dev 分支的功能</h3><p>dev 有两个功能，一个是发布到测试环境进行新功能测试，另外一个是用于团队成员进行 mr 时候使用的分支，最新功能一旦开发测试完毕，就进行 origin/branchname mr 到 upstream/dev 的操作， 分配给其他项目成员进行 review 。<br>mr 期间成员可以任意对代码进行审查评论，mr 发起人需要对评论进行回应。  </p>
<h3 id="master_分支的功能">master 分支的功能</h3><p>master 是生产环境所使用的代码，因此得确保 master 分支的代码时刻可用。如何确保，就是确保 dev 的代码能够无已知 bug 地运行了，才进行 upstream/dev mr upstream/master 的操作。dev 一旦新功能测试成功，就提 mr 至 master 分支， 分配给自己。然后自己点击 accept mr 的操作。<br>这一步操作，看似多余，但是能确保 master 分支时刻可用。</p>
<h2 id="mr_的规范">mr 的规范</h2><p>上面讲完了两个分支的作用，这是大部分仓库基本上的操作，估计很多人都清楚。<br>那如何是用这两个分支进行方便团队协作呢？这个就是一门学问了。<br>由于前面提到了， dev 和 master 只能通过 mr 方法进行代码的变动，所以，提交 mr 的时候就需要确保该 mr 能够让 git 仓库程序自动 accept（自动 accept 的意思是点击 accept 按钮就能合并代码），其他成员确定 mr accept 时候，只需点击按钮即可完成，而不是 merge this request manually 。</p>
<h2 id="团队协作踩坑大法">团队协作踩坑大法</h2><p>说一个场景很容易遇到的场景，假设项目 A 同时有 B 、 C 两个功能同时开发。不久， B 、 C 同时提了个 mr 上来。然后， B 经过 review 目测无 bug，点击了 accept ， 然后 C 也经过了 review 目测无 bug，点击了 accept 。<br>但是目测失败了，线上生产环境是非常复杂，一堆的机器、分布式数据库，超大数据量等等，造成 B 功能在模拟环境运行失败的情形。然而此时 C 功能目测无 bug 测试也无 bug ，可发布生产环境了。但是由于 B 功能出现 bug ，dev 此时就不能进行 mr 到 master 进行功能发布了。<br>C 功能急着发布，也只能看着 B 功能的成员修复此 bug 了。或者先把 B 功能从 dev 慢慢抠出来发布。但是这个是坑。</p>
<p>这里的漏洞就是 B 、 C 功能在 mr 阶段没有进行模拟生产环境测试就直接 accept 造成的。所以，就得解决这个问题。只有通过了 mr 阶段的模拟生产环境测试的 mr 才能点击 accept 进行代码合并。</p>
<h2 id="如何解决_mr_阶段测试的问题">如何解决 mr 阶段测试的问题</h2><p>说说项目的测试环境，<br>1、 用于 dev 分支代码的测试，基本上和生产环境一致，只是运行的代码不同而已。<br>2、 用于测试 mr 的测试环境，mr 测试的功能由自己控制，随便部署，每个提交 mr 的所有者需要部署 mr 环境给其他 review 代码的成员进行测试使用。在确保代码质量的同时，也确保了由于开发环境跟生产环境差异造成的代码缺陷。</p>
<h2 id="团队协助规范">团队协助规范</h2><ol>
<li>禁止 push 代码至非 origin 仓库  </li>
<li>使用 fetch + rebase 代替 pull + merge 更新其他成员最新的代码，不予许使用 pull + merge  </li>
<li>upstream 只能通过 mr 方式进行代码合并请求  </li>
<li>功能 mr 必须 asign 给非自己进行代码审查  </li>
</ol>
<hr>
<p>我要开始讲故事了</p>
<hr>
<h2 id="如何进行团队的协助">如何进行团队的协助</h2><p>以场景进行讲解吧。</p>
<h3 id="需求订立">需求订立</h3><p>开发的功能都商量好了，产品狗可以一边玩去。项目起了个响当当的名字，叫做古猫搜索引擎，小明（git id ming） 和 小花（git id hua，女的打字工哦） 再加几个打酱油的打字工进行开发。</p>
<h3 id="创建仓库">创建仓库</h3><p>他们创建了个组织叫古猫组织（git id goocat），然后创建了个 goocat 仓库，设置主分支为 dev ，master 留着暂时不管，push 个 相同的 init 到 dev 和 master ，然后把小明和小花还有几个打酱油的设置为管理员权限。仓库就这样子弄上来了。 .gitignore 、 WTFPL 什么的，也在这个时候加上去。  </p>
<h3 id="打字工出场">打字工出场</h3><p>这个时候，产品狗的什么，已经为了避免冲突，被送去某个小黑屋好好呆着了。<br>其他打酱油的被分配开发数据库什么的了。<br>小明和小花就马上动手写代码开发 index 页面，自己动手，丰衣足食。马上 fork 仓库， git clone 、 git remote add 什么一气呵成， add 了 upstream 和其他项目组成员的仓库地址。<br>小明用上了打 dota 的 apm ，瞬间把后台功能完成了， push origin api 完成，接下来等妹子小花来补充前端开发了。小花真羡慕打 dota 的人的 apm 能这么高，用来写代码瞬间就写完了。<br>但是小明完成的功能只是整个功能的一半，需要小花继续进行，所以小花第一步就是更新小明的代码下来<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git remote -v </span><br><span class="line">git remote add ming git@**<span class="class">.com</span>:ming/goocat<span class="class">.git</span></span><br><span class="line">git fetch ming </span><br><span class="line">git checkout -<span class="tag">b</span> page </span><br><span class="line">git rebase -<span class="tag">i</span> ming/api</span><br></pre></td></tr></table></figure></p>
<p>然后根据提示把 rebase 进行到底。这样子就能获取小明最新的代码了。</p>
<p>小花技术也杠杠的，瞬间接上了小明的几个 api。</p>
<h3 id="需求变动">需求变动</h3><p>到了某个 api 的时候，发现页面展示效果其实没那么好，这个时候召唤产品狗和小明过来。</p>
<p>他们间对话</p>
<blockquote>
<p>小花：这个功能我要这样这样这样，这样才是最好的交互效果。<br>小明这个时候使劲点头，手里的也不停下，拿着犀牛书在看。也能够在跟产品狗起争执时候一书拍过去，屡试不爽好吗，那个产品狗都被吓怕了。<br>产品狗看了下小明的犀牛书，擦了下汗：这个想法非常好，就这么实现了</p>
</blockquote>
<p>就这样子，没啥废话，需求就这样变吧。</p>
<h3 id="多人协作">多人协作</h3><p>需求变动了，api 继续变下，小花女神交代小明改改api，我的分支是 apge ，小明刷刷刷几下就马上动手改了。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">git checkout api</span><br><span class="line">git status</span><br><span class="line">git remote -v</span><br><span class="line">git remote add nvshen git<span class="comment">@**.com:hua/goocat.git</span></span><br><span class="line">git fetch nvshen</span><br><span class="line">git stash</span><br><span class="line">git rebase -i nvshen/page</span><br><span class="line"><span class="comment"># 坐等 git rebase 完成</span></span><br><span class="line">git stash pop</span><br><span class="line">vim <span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>.py</span><br><span class="line">vim api.md</span><br><span class="line"><span class="comment"># 编辑完毕代码</span></span><br><span class="line">git add <span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>.py api.md</span><br><span class="line">git commit -m '根据女神说的需求改动，进行 古猫搜索部分 api 改动'</span><br><span class="line">git push origin api</span><br></pre></td></tr></table></figure>
<p>然后跑过女神那里说： 小花，改动完了，你 fetch 下来看看呗。<br>小花有开始了这个功能代码的编写，获取小明最新的代码：<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git stash </span><br><span class="line">git fetch ming</span><br><span class="line">git <span class="keyword">push</span> origin page</span><br><span class="line">git rebase -i ming/api</span><br><span class="line">git stash <span class="keyword">pop</span></span><br></pre></td></tr></table></figure></p>
<p>然后继续进行代码的开发，编写完毕果断使用 github 客户端进行代码的 commit，不错不错，功能 done 。提交仓库给小明吧。<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">push</span> origin page</span><br><span class="line"><span class="preprocessor"># 打印了一堆的冲突的信息</span></span><br><span class="line">git <span class="keyword">push</span> -f origin page</span><br></pre></td></tr></table></figure></p>
<p>然后到线上仓库看看时候提交成功了，看看 commit ，看到了之前小明的 commit </p>
<blockquote>
<p>‘根据女神说的需求改动，进行 古猫搜索部分 api 改动’</p>
</blockquote>
<p>然后小花又叹气了</p>
<blockquote>
<p>这小明，老是这样子，一点勇气都没有。</p>
</blockquote>
<p>然后在微信朋友圈发了条 Text ： 你主动一点，我们之间就会有故事。<br>然后告知小明前端开发完毕了，提 mr 测试吧。</p>
<h3 id="mr_操作">mr 操作</h3><p>这个时候小明就开始提 mr 了<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git fetch nvshen</span><br><span class="line">git <span class="keyword">push</span> origin api</span><br><span class="line">git rebase -i nvshen/page</span><br><span class="line">git <span class="keyword">push</span> -f origin api</span><br></pre></td></tr></table></figure></p>
<p>上仓库进行 mr 了，提交了个 mr ，指向给了某一个打酱油的打字工 A 进行 review ，看到写着不能自动 accept，原来其他几个打酱油的已经把部分功能提交并且 accept 了，而且代码有冲突，这个时候小明就要做成没冲突了。<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git fetch upstream</span><br><span class="line">git rebase -<span class="tag">i</span> upstream/dev</span><br><span class="line">git push -f origin api</span><br></pre></td></tr></table></figure></p>
<p>回 upstream 仓库看看，不错，能自动 accept 了。</p>
<h3 id="review_&amp;&amp;_accept">review &amp;&amp; accept</h3><p>打酱油 A 提了部分意见，小明都一一做了改动。最后 mr 环境测试成功了， accept ，发布到 dev 环境， 也成功，上线，古猫搜索引擎 demo 版本出来了。<br>v0.1.0 实现了。</p>
<h3 id="打版本了">打版本了</h3><p>产品狗一阵激动，终于实现了小部分了。<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone git@**<span class="class">.com</span>:goocat:goocat<span class="class">.git</span></span><br><span class="line">git checkout dev</span><br><span class="line">git tag v0.<span class="number">1.0</span></span><br><span class="line">git push origin --tag</span><br></pre></td></tr></table></figure></p>
<p>奔走相告，今晚大家唱歌庆祝。白天鹅 KTV 唱 K。</p>
<h3 id="庆功会">庆功会</h3><p>小花点了一首歌： she 的 《恋人未满》，申请的唱出来了，眼睛还冒着泪花，时不时还望了望小明。</p>
<p>故事唱完了，小花很伤心：</p>
<blockquote>
<p>那小明怎么能这样子，一点都不主动。  </p>
</blockquote>
<p>然后喝了很多酒。结果醉了，领导说：</p>
<blockquote>
<p>小明，公司里面你和小花关系最好了，今晚你负责送她回家啦。  </p>
</blockquote>
<p>小明呆呆的望着女神去了。</p>
<p>散场了，小明扶着小花上了出租车，送小花回家，然后就没有然后了。<br>这是个悲伤的故事。</p>
<hr>
<p>故事讲完了，大家洗洗睡吧。</p>
<hr>
<h2 id="科普下上面提到的名词">科普下上面提到的名词</h2><p>upstream : 上层仓库<br>origin : 当前所有者的仓库<br>master : 生产代码主分支<br>dev : 开发代码主分支<br>merge : 合并代码<br>mr : merge request, 合并代码请求<br>accept : 接受代码合并请求<br>review : 队友对你的代码进行审查<br>bug : 八阿哥<br><del>以下的词我解析不了，有很多东西中文是没法解析的，自己理解</del><br>git : 词典释义为饭桶，无用的人 →_→<br>organization : 相对于成员，它就是组织<br>fork : 词典释义为叉子<br>clone : 克隆</p>
<h2 id="彩蛋">彩蛋</h2><p>看到这里，也挺艰难的，其实 dev 测试环境可以去掉不用。<br>至于其他的不同的方法，欢迎评论指导。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>今天一个朋友在他们的 git 工作流上面遇到问题了。来询问我关于我们团队是如何使用 git 进行团队协作的。 然后我就秉着技术分享的思想给他们讲解。特意写下此文。git 这东西，用得好就是好东西。用得不好，那就只能怪你没下功夫去用了。骚年，勇敢的用起来吧。  </p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[XSRF测试题]]></title>
    <link href="http://shenqihui.github.io/2015/01/17/XSRF/"/>
    <id>http://shenqihui.github.io/2015/01/17/XSRF/</id>
    <published>2015-01-16T16:38:04.000Z</published>
    <updated>2015-03-12T05:49:13.000Z</updated>
    <content type="html"><![CDATA[<p>这个是一个测试 xsrf 的测试题，具体实现思想可能猥琐。看看谁能想到和我一样猥琐的方案。</p>
<a id="more"></a>
<h1 id="网络环境">网络环境</h1><p>现在的场景是A站点和B站点，假设A站是新浪，B站是我们控制的站，<br>所以B站的后端代码随便该。A站的话，参考新浪主页。</p>
<hr>
<h1 id="想干啥">想干啥</h1><p>我们发现了个新浪主页的XSS漏洞，就是能注入我们的 script 进去，用户打开特定网址后，就运行我们的 script ，我们就能获取一堆信息，现在想把信息发送回来。信息可能非常非常的大，大于 GET 方式能处理的长度。   </p>
<hr>
<h1 id="B站的环境">B站的环境</h1><p>目前已经有一个 get 和 post 方式共用的 api。<br>例如 get 方式的，<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.get(<span class="string">"api.html"</span>, &#123; name: <span class="string">"John"</span>&#125; );</span><br></pre></td></tr></table></figure></p>
<p>或者 post 方式的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.post(<span class="string">"api.html"</span>, &#123; name: <span class="string">"John"</span>&#125; );</span><br></pre></td></tr></table></figure></p>
<p>然后这两种方式，任意一中，就能把 { name: “John”} 这个信息发送回 B站 进行存储了。<br>B站已经进行了任何的跨域请求，例如 Access-Control-Allow-Origin， p3p等等。</p>
<hr>
<h1 id="A站的环境">A站的环境</h1><p>A站环境未知，也可以说是任意，但是我们有办法在 A站 的页面注入我们的 script</p>
<hr>
<h1 id="不能使用的解决方式">不能使用的解决方式</h1><p>不能使用 flash </p>
<hr>
<h1 id="任务：要做什么">任务：要做什么</h1><p>任务1，不改变现有接口的前提下，实现</p>
<ol>
<li>解决 chrome 现代浏览器该怎么发送数据。</li>
<li>解决了 上面的，那就开始解决 低版本 IE 了。要求兼容 IE6 ，比较变态，但是这个业务不能忽略 IE6 等。（用代码体现）<br>提示：跨域，HTTP状态，实现方式能多猥琐就多猥琐。</li>
</ol>
<p>任务二，躺床上，想一种更好的方法，也不能用 flash。不用写代码，说说思路，这个时候能任意改 B站 API。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>这个是一个测试 xsrf 的测试题，具体实现思想可能猥琐。看看谁能想到和我一样猥琐的方案。</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[自己收集的一堆开发有用的网址]]></title>
    <link href="http://shenqihui.github.io/2014/11/04/%E8%87%AA%E5%B7%B1%E6%94%B6%E9%9B%86%E7%9A%84%E4%B8%80%E5%A0%86%E5%BC%80%E5%8F%91%E6%9C%89%E7%94%A8%E7%9A%84%E7%BD%91%E5%9D%80/"/>
    <id>http://shenqihui.github.io/2014/11/04/自己收集的一堆开发有用的网址/</id>
    <published>2014-11-03T19:36:00.000Z</published>
    <updated>2015-02-15T15:41:34.000Z</updated>
    <content type="html"><![CDATA[<p>1、查看 ip、ua 以及&nbsp;X Forwarded For，来自v2的，平常识别下自己的机器信息。&nbsp;<a href="http://www.v2ex.com/ua" target="_blank" rel="external">http://www.v2ex.com/ua</a><br><a id="more"></a><br>&nbsp;</p>
<p>2、楼下补充</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>1、查看 ip、ua 以及&nbsp;X Forwarded For，来自v2的，平常识别下自己的机器信息。&nbsp;<a href="http://www.v2ex.com/ua">http://www.v2ex.com/ua</a><br>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[支付宝么么哒]]></title>
    <link href="http://shenqihui.github.io/2014/10/30/%E6%94%AF%E4%BB%98%E5%AE%9D%E4%B9%88%E4%B9%88%E5%93%92/"/>
    <id>http://shenqihui.github.io/2014/10/30/支付宝么么哒/</id>
    <published>2014-10-29T20:44:00.000Z</published>
    <updated>2015-02-15T15:41:34.000Z</updated>
    <content type="html"><![CDATA[<p><img src="http://images.cnitblog.com/blog/358891/201410/301244088943397.png" alt=""></p>
<p>么么哒。<br><a id="more"></a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="http://images.cnitblog.com/blog/358891/201410/301244088943397.png" alt=""></p>
<p>么么哒。<br>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[js页码生成库，一个适合前后端分离的页码生成器]]></title>
    <link href="http://shenqihui.github.io/2014/07/13/js%E9%A1%B5%E7%A0%81%E7%94%9F%E6%88%90%E5%BA%93%EF%BC%8C%E4%B8%80%E4%B8%AA%E9%80%82%E5%90%88%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E7%9A%84%E9%A1%B5%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/"/>
    <id>http://shenqihui.github.io/2014/07/13/js页码生成库，一个适合前后端分离的页码生成器/</id>
    <published>2014-07-13T01:50:00.000Z</published>
    <updated>2015-05-12T15:40:51.000Z</updated>
    <content type="html"><![CDATA[<p><strong>前言</strong></p>
<p>上星期写的任务里面有需要进行分页的处理，git搜索了一番，没有觉得合适的，于是自己临时写了个分页的算法。</p>
<p>然后等闲下来的时候，决定把分页进行优化并推广。于是乎，一个适合前后端分离的页码生成器就这样出来了。<br><a id="more"></a><br>先别废话了，直接上 <a href="https://github.com/shenqihui/pagination" target="_blank" rel="external">git 地址</a> 和 <a href="http://shenqihui.github.io/pagination/" target="_blank" rel="external">demo 地址</a>。看官果断点击进去瞧瞧看。项目主页的 readme 文档的自动排版将更好。</p>
<p><strong>先讲讲设计思想</strong></p>
<p>整个开发流程围绕事件绑定进行开发。</p>
<p>脱离 callback 回调这种回调方法，直接使用 事件 方式触发换页前后的动作，方便解耦。</p>
<p>既然使用这种方式进行回调，就使用全局变量挂载分页的数据，方便回调时候进行分页数据的访问。</p>
<p><strong>库的依赖</strong></p>
<p>由于开发库的时候，并没有使用原生的语法进行元素或者事件绑定的操作，因此需要依赖某个库。</p>
<p>现阶段，经过测试支持 zepto 以及 jquery （二选一）。</p>
<p>css 方面，建议还是直接自己写或者使用 bootstrap 的库，源代码里面有从 bootstrap 里面抽出来的分页 css 代码。</p>
<p><strong>简洁demo</strong></p>
<p>由于分页就必须知道分页数据大小，因此必须传输配置对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pageConfig = &#123;</span><br><span class="line">  <span class="comment">// 每页显示的数据长度，必填，而且 &gt;1</span></span><br><span class="line">  prePageLenght: <span class="number">10</span>,</span><br><span class="line">  <span class="comment">// 数据的总长度，必填，而且 &gt;1</span></span><br><span class="line">  dataLength: <span class="number">30</span>,</span><br><span class="line">  <span class="comment">// 现在的页码，默认 1</span></span><br><span class="line">  pageNow: <span class="number">1</span>,</span><br><span class="line">  <span class="comment">// 渲染分页 html 的容器，一般框架的容器即可</span></span><br><span class="line">  renderBox: $(<span class="string">'.pagination-box'</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>配置之后，进行调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 运行即可分页</span></span><br><span class="line">pageBuilder(pageConfig);</span><br></pre></td></tr></table></figure>
<p>这样子就能进行分页了。</p>
<p><strong>回调的书写</strong></p>
<p>回调的书写虽然放在了调用分页的主函数后面，但是记得在调用分页之前就定义这些事件，因为一旦调用分页函数，就马上触发分页回调，写在后面了，就会忘记了刚分页时候的事件回调了。</p>
<p>首先是分页前的回调，分页之前会触发 window 下面一个自定义分页之前的事件&nbsp;<span class="s1">beforePageChange ，因此要触发处理分页前的动作，就这样处理：</span></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提前定义好分页之前的动作，可选</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'beforePageChange'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// callback</span></span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">  <span class="comment">// 获取当前页码，可以从 pageBuilder.page.pageNow 取得，注意此时的值为未分页之前的旧页码。</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>同样道理，分页之后的回调差不多：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提前定义好分页之后的动作，可选</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'afterPageChange'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// callback</span></span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">  <span class="comment">// 获取当前页码，可以从 pageBuilder.page.pageNow 取得</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>特别说明</strong></p>
<p>一个页面只适合使用一个分页实例。分页的动作将在 hashchange 触发之后进行分页。</p>
<p>里面监控页码变化的函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绑定换页的事件</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'hashchange'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hash = location.hash;</span><br><span class="line">  <span class="keyword">var</span> pageTemp = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/^#page=\d+$/</span>.test(hash) === <span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="comment">// 直接是页码的</span></span><br><span class="line">    pageTemp = hash.substring(<span class="number">6</span>) | <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (defaultConfig.pageNow !== pageTemp) &#123;</span><br><span class="line">      defaultConfig.pageNow = pageTemp;</span><br><span class="line">      $(<span class="built_in">window</span>).trigger(<span class="string">"renderPagination"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hash === <span class="string">"#page=next"</span>) &#123;</span><br><span class="line">    <span class="comment">// 下一页的</span></span><br><span class="line">    location.hash = <span class="string">"page="</span> + ( defaultConfig.pageNow + <span class="number">1</span> );</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hash === <span class="string">"#page=prev"</span>) &#123;</span><br><span class="line">    <span class="comment">// 上一页的</span></span><br><span class="line">    location.hash = <span class="string">"page="</span> + ( defaultConfig.pageNow - <span class="number">1</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>因为 hashchange 只支持 IE8+，</p>
<p>所以，该插件只适合 IE8+，甚至IE8的怪异模式不支持 hashchange 事件。</p>
<p><strong>结束语</strong></p>
<p>这个库还有很多可以优化的地方，例如页码缓存，还有作用域优化之类的，还没进行优化。</p>
<p>希望大家喜欢。喜欢的话，点个推荐吧，如果使用上了，记得 star 下哦。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><strong>前言</strong></p>
<p>上星期写的任务里面有需要进行分页的处理，git搜索了一番，没有觉得合适的，于是自己临时写了个分页的算法。</p>
<p>然后等闲下来的时候，决定把分页进行优化并推广。于是乎，一个适合前后端分离的页码生成器就这样出来了。<br>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[任何一个团队，永远不会像你想象中的那么好，也不会如你所听说的那么糟。]]></title>
    <link href="http://shenqihui.github.io/2014/02/28/%E4%BB%BB%E4%BD%95%E4%B8%80%E4%B8%AA%E5%9B%A2%E9%98%9F%EF%BC%8C%E6%B0%B8%E8%BF%9C%E4%B8%8D%E4%BC%9A%E5%83%8F%E4%BD%A0%E6%83%B3%E8%B1%A1%E4%B8%AD%E7%9A%84%E9%82%A3%E4%B9%88%E5%A5%BD%EF%BC%8C%E4%B9%9F%E4%B8%8D%E4%BC%9A%E5%A6%82%E4%BD%A0%E6%89%80%E5%90%AC%E8%AF%B4%E7%9A%84%E9%82%A3%E4%B9%88%E7%B3%9F%E3%80%82/"/>
    <id>http://shenqihui.github.io/2014/02/28/任何一个团队，永远不会像你想象中的那么好，也不会如你所听说的那么糟。/</id>
    <published>2014-02-27T19:35:00.000Z</published>
    <updated>2015-02-15T15:41:34.000Z</updated>
    <content type="html"><![CDATA[<p>标题这句话是玉伯说的。<br><a id="more"></a><br>&nbsp;</p>
<p><strong>缘由：</strong></p>
<p>看了这个问题：<span><a href="http://www.zhihu.com/question/20084964" target="_blank" rel="external">淘宝 UED 前端、腾讯脚本开发、豆瓣前端开发，应该如何在这几个工作之间选择？</a>&nbsp;，有自己</span>的感受。</p>
<p>&nbsp;</p>
<p><strong>背景：</strong></p>
<p>三天前，也就是 2014 年 02 月 25 日，我向领导提交了辞职申请表，裸辞。辞职的理由是：追求专注于互联网的团队。</p>
<p>领导看完申请表之后，马上过来问我什么情况，我的回答：想换个专注于互联网的环境。</p>
<p>昨天 ( 2014 年 02 月 27 日 ) 领导和我详细谈了下，确定在 2014 年 03 月 14 日&nbsp;(2014年3月4日注：离职提前到了20140304)。最近都在做交接工作和做一些补充性的功能之后发给接手的同事。</p>
<p>离职时间已定，我在公司的时间不算长，20130301-20140314，一年多一点点，毕业后的第一份正式工作。(2014年3月4日注：离职提前到了20140304)</p>
<p>在公司 ( 某大屏幕制造方向的公司 ) 期间，参与了公司的一个大项目的三大模块，公司的专职前端开发工程师只有两个，因此我算是负责这个大项目的主前端了。项目的架构师前端知识也很牛 ( CSS，响应式设计除外 ) ，所以我主要 协助架构师进行JS架构 和 进行多皮肤多终端下面的响应式CSS框架的架构。对自己的CSS长进还是很足的，另外也使用工厂模式开发了一个地图控件库，三个视频控件库 ( 差不多一样功能 ) 。&nbsp;</p>
<p>当团队和部门的同事知道我要辞职的消息之后，都会问我一个这样子的问题：</p>
<blockquote>
<p>同事：怎么突然间辞职了，找到下一家了没有？</p>
<p>我：想换个环境吧，裸辞。</p>
<p>同事：这么傻，干嘛不等到找到了再辞职？</p>
</blockquote>
<p>&nbsp;</p>
<p><strong>裸辞原因：</strong></p>
<p>至于这个 &ldquo;为什么要裸辞？&rdquo; 这个原因，我觉得没什么原因吧。</p>
<p>主要是大家的观念都是骑驴找马、没有足够的勇气裸辞、怕裸辞之后没能快速找到工作，而我的观念是裸辞、有勇气、花时间下去找好工作。这个就是为什么裸辞的原因。</p>
<p>辞职了之后，我有时候晚上会想想，如果工作找不到怎么办？那就只能逼自己学习拥有更牛的技术，让别人希望你加入他们团队。</p>
<p>&nbsp;</p>
<p><strong>离职原因：</strong></p>
<p><span style="line-height: 1.5;">上面提到我回答领导问题的答案是：想换个专注于互联网的环境。</span></p>
<p>看到知乎上面 <a href="http://www.zhihu.com/people/sofish" target="_blank" rel="external">@sofish</a>&nbsp;的回答中的一句话 ：</p>
<blockquote>
<p>我爸爸常告诉我，不要轻易离职，只有当你呆足够久了才可能知道是这个团队不适合你，还是你没有适应这个团队 <a href="http://www.zhihu.com/question/20084964" target="_blank" rel="external">撮这里看原答案</a></p>
</blockquote>
<p><span>此时我清楚的明白到，这个团队不适合我。我想做互联网的项目，针对的是普通大众，而不是特定的人群 ( 现在所做项目受众就是特定的人群 ) 。</span></p>
<p><span>而且我不希望搞 jsp 开发。在现在的团队里面，使用了 Lifray 的框架，开发出来的页面对我来说，都觉得是不可控的，总觉得不踏实。</span></p>
<p><span>我喜欢的是 php/python ，当然如果是直接使用 api 的话根本不用管后台用什么语言进行开发。</span></p>
<p><span>另外， Liferay 的启动是在太慢了，而且框架自带的 UI 太庞大，扔个原版 bootstrap 3.0 进去都会造成不兼容。</span></p>
<p><span>还有一个很重要的原因：<strong>太闲了，基本不用加班，而且项目过度阶段能闲上1个月不用写代码。</strong>这是一个致命的原因，对于一个刚毕业的技术菜鸟来说，适当繁重的工作任务对技能的提升有非常大的帮助。现阶段我更希望到有加班氛围的公司。<br></span></p>
<p><span>有人说那为什么你当初加入这个团队，这个只能怪自己在毕业的时候，没能力选择更好的企业，老师说：&ldquo;先就业后择业&rdquo;。</span></p>
<p><span>当时有一个创业团队，一直在实习，可以毕业之后留下来，做电子商务网站的。而我选择了现在这个大屏幕制造的股份公司，稳定，福利好，大公司。</span></p>
<p>&nbsp;</p>
<p><strong>为啥现在离职：</strong></p>
<p><span>当然，年终奖是一个诱惑。</span></p>
<p><span>1月多，参与的项目算是初步做完，不用中途退出给别人留个烂摊子，都快到年了，拿了年终奖再走吧。</span></p>
<p>&nbsp;</p>
<p><strong>我所希望的团队：</strong></p>
<p><span>在我的理念了，最好的前后端开发方式是：前端单纯写 html ，通过各种 api 与后台进行交互。这个也是大部分前端开发工程师觉得最可操控的一种模式吧。</span></p>
<p><span>但是现实往往不是这样，例如数据展现是直接一个 php 或者 jsp 生成一段 html 代码的方式。</span></p>
<p><span>代码管理最好使用 git ，这样就能尽量避免队友在无意间提交的失误造成 bug ，能针对性的审查代码。当然 svn 也行，需要在更新的时候进行所有更新的代码的审查。</span></p>
<p><span>团队成员为了产品，乐意加班，乐意奉献，一个团队不为别的，就为了自己的产品能做好，越快完成越好。</span></p>
<p>&nbsp;</p>
<p><strong>任何一个团队，永远不会像你想象中的那么好，也不会如你所听说的那么糟。</strong></p>
<p><span style="line-height: 1.5;">在一个团队里，如果你觉得团队太糟了，原因只有两个：1、这个团队不适合你。2、你没适应这个团队。不然，这个团队早就瓦解了。</span></p>
<p><span style="line-height: 1.5;">上至团队老大，下至团队最小能力最差的码农，都有自己的在团队里面的一席之地，要么就是技术能力上的增长，要么就是管理能力上的增长。</span></p>
<p><span style="line-height: 1.5;">可能你在寻找工作的时候，看到团队的描述是多么的美好，结果加入了却发现某些问题，这个不可避免，毕竟在想象里面的东西可以使完美的。</span></p>
<p><span style="line-height: 1.5;">发现不完善的东西，你可以努力尝试改变它，如果不可改变，那就一定是有存在的道理，例如为啥微信还在用 svn 进行代码管理：因为 svn 通用，稳定，很多人擅长；项目开始的时候没考虑那么多，使用了，改动不过来。等等。</span></p>
<p>&nbsp;</p>
<p>扯淡结束了，突然间觉得自己的全文跟标题有一点点跑偏的感觉。</p>
<p>&nbsp;</p>
<p><strong>卖一下广告，求职：</strong></p>
<p>离职了，处于交接阶段，当然得着手找工作，我也在投简历中。</p>
<p>如果有团队希望接纳我，请考虑下我，猛戳 <a href="http://shenqihui.github.io/lab/resume/" target="_blank" rel="external">我的简历</a>&nbsp;，简历一直在修改。昨天看到了 <a href="http://yuguo.us/" target="_blank" rel="external">余果</a>&nbsp;的简历，觉得我们间距居然那么大 T_T 。不过嘛，人家工作那么久了，差距<span style="line-height: 1.5;">肯定有。</span></p>
<p>如果是大牛，根本不用简历。例如传说中 <a href="http://zh.wikipedia.org/zh-cn/%E5%90%89%E5%A4%9A%C2%B7%E8%8C%83%E7%BD%97%E8%8B%8F%E5%A7%86" target="_blank" rel="external"><span>Guido</span></a>&nbsp;去面试 google 的时候的简介描述就一句话：T WROTE PYTHON. &nbsp;当然，我还没那么牛，现在还是一个小菜鸟。T_T</p>
<p>也说说我的期望吧：</p>
<p>1、地点：暂时只考虑广州。</p>
<p>2、团队方向：（移动）互联网方向，产品受众面广。</p>
<p>3、不写 JSP。因为不太懂。T_T。</p>
<p>4、职位：前端开发 / 页面重构。</p>
<p>&nbsp;</p>
<p>谢谢看这一篇扯淡，如果觉得你赞同其中的某个观点，点个赞吧。^_^</p>
<p>更新信息一：2014年3月3日</p>
<p>offer已经收到，是位于珠江新城附近的一个移动互联网公司，虽然福利没有之前公司好，但是，估计在这个公司能学到更牛的技术。</p>
<p>昨天跟朋友说：五年后，我要成为一个：找工作时，开价年薪30w，别人还抢着要我的牛人。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>标题这句话是玉伯说的。<br>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[探讨javascript面向对象编程]]></title>
    <link href="http://shenqihui.github.io/2014/02/12/%E6%8E%A2%E8%AE%A8javascript%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"/>
    <id>http://shenqihui.github.io/2014/02/12/探讨javascript面向对象编程/</id>
    <published>2014-02-11T21:58:00.000Z</published>
    <updated>2015-05-12T15:50:20.000Z</updated>
    <content type="html"><![CDATA[<p><strong>前言：</strong></p>
<p>下面将探讨 javascript 面向对象编程的知识。</p>
<p>请不要刻意把 javascript 想成面向对象编程是理所当然的。<br><a id="more"></a><br>javascript 里面，对象思想不可少，但是不一定需要面向对象编程，有时候，我们需要的只是一个实例化了的对象，而不是一个创建对象的类。</p>
<p>偏要这样做的话，也行，请看下文。另外请勿与传统面向对象编程做对比，这没有可比性。</p>
<p>对于 javascript 来说，所有的变量都可以被称为对象。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">'hello world'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a.toUpperCase());</span><br></pre></td></tr></table></figure>
<p>这里面，a为字符串对象。有其能直接调用的方法。但是这篇文章不讨论这一类的变量，而是讨论如何自定义对象。</p>
<p><strong>声明一个对象：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br></pre></td></tr></table></figure>
<p>通过上面这两种方式中任意一种，就就声明了一个对象变量，这是一个实例，而且，是一个空对象,不能继承。</p>
<p>何为空对象，就是这个对象里面没有定义任何成员和方法。</p>
<p><strong>设置对象成员和方法：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = &#123;&#125;;</span><br><span class="line">Person.name = <span class="string">'Tom'</span>;</span><br><span class="line">Person.gender = <span class="string">'male'</span>;</span><br><span class="line">Person.sayHello = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Hello "</span>+<span class="keyword">this</span>.name+<span class="string">"."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是一种最直观最简单的对象定义及成员方法添加的方法，里面定义了 person 对象，person 有 name 和 gender 的成员，以及 sayHello 的方法。这也是一个实例，不能继承。通过 person.name/persion.gender 能直接引用该对象的成员，person.sayHello() 能直接调用该对象的方法。这算基础。</p>
<p>在 sayHello 方法中，this 指向的就是 person，和其他的面向对象编程方法相同。</p>
<p>上面声明对象的方法太过于累赘，一般选择下面这种对象声明的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = &#123;</span><br><span class="line">  name:<span class="string">'Tom'</span>,</span><br><span class="line">  gender:<span class="string">'male'</span>,</span><br><span class="line">  sayHello:<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Hello "</span>+<span class="keyword">this</span>.name+<span class="string">"."</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样的声明方法比上面的方法都简洁，首推方法。成员方法调用方式一样。</p>
<p><strong>声明一个可继承的类：</strong></p>
<p><strong>情景一：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name || <span class="string">'NoName'</span>;</span><br><span class="line">&#125;;</span><br><span class="line">Person.sayHello = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Hello "</span>+<span class="keyword">this</span>.name+<span class="string">"."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Tom = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure>
<p>这样子，就等于声明了一个 person 的类，Tom 就是 person 的一个实例。但是 person.sayHello 方法就等于是私有属性，不能被继承，所有 Tom 没有 sayHello 的方法。</p>
<p><strong>情景二：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name||<span class="string">"NoName"</span>;</span><br><span class="line">  <span class="keyword">this</span>.sayHello = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Hello "</span>+<span class="keyword">this</span>.name+<span class="string">"."</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> Tom = <span class="keyword">new</span> Person(<span class="string">'Tom'</span>);</span><br><span class="line">Tom.sayHello();</span><br></pre></td></tr></table></figure>
<p>这样也是定义对象的一个方法，person 是一个类，其 name 和 sayHello 可被实例继承。但是有一个缺陷，如果通过此类创建多个实例，那么这个类就存在多少份的复制，就如上面来说，创建多个实例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Tom1 = <span class="keyword">new</span> Person(<span class="string">"Tom1"</span>);</span><br><span class="line"><span class="keyword">var</span> Tom2 = <span class="keyword">new</span> Person(<span class="string">"Tom2"</span>);</span><br><span class="line"><span class="keyword">var</span> Tom3 = <span class="keyword">new</span> Person(<span class="string">"Tom3"</span>);</span><br></pre></td></tr></table></figure>
<p>此时，Person 就存在三个实例，每个实例有自己的成员和方法，内存中有三个 sayHello 方法的引用。sayHello 作为一个通用的方法，这样定义的话，在新建多个实例时，就会造成内存的浪费。因此，应该把通用的方法使用原型链的方式定义，请看情景三。</p>
<p><strong>情景三：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name||<span class="string">"NoName"</span>;</span><br><span class="line">&#125;;</span><br><span class="line">Person.prototype.sayHello = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Hello "</span>+<span class="keyword">this</span>.name+<span class="string">"."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Tom = <span class="keyword">new</span> Person(<span class="string">'Tom'</span>);</span><br><span class="line">Tom.sayHello();</span><br></pre></td></tr></table></figure>
<p>通过原型链的方式，基于这个类新建的实例，其方法就不会再内存里面存在多个实例。</p>
<p>但是此时，又涉及一个问题，如何知道 Tom 属于哪个类的呢，通过哪个构造函数来创建的呢？就引申到情景四了。</p>
<p><strong>情景四：</strong></p>
<p>这里，讨论的是实例的构造函数，每一个对象都有一个 construcor 的成员方法，指向的是创建该对象的那个函数。</p>
<p>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]; <span class="comment">//此时arr1.constructor就是Array。</span></span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;&#125;;<span class="comment">//此时func.constructor就是Function。</span></span><br></pre></td></tr></table></figure>
<p>因此，情景三中的 Tom.constructor 就是 Person，就是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(name)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name||<span class="string">"NoName"</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这一个函数。通过 new 运算符创建的实例，该实例成员 constructor 所指向的就是 new 后面的变量。</p>
<p>题外话，说说 new 运算符，MDN 上面<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new" target="_blank" rel="external">关于new运算符的定义</a>是这样的：</p>
<blockquote>
<p>The new operator creates an instance of a user-defined object type or of one of the built-in object types that has a constructor function.</p>
</blockquote>
<p>大意是：new 运算符能为那些存在构造函数的用户自定义对象类型或者浏览器内部实现对象类型创建一个实例。</p>
<p>new的语法格式为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> constructor[([<span class="built_in">arguments</span>])];</span><br></pre></td></tr></table></figure>
<p>可以明显看出 实例的成员 constructor 就是创建该实例的对象类型。</p>
<p>上面的四个情景，都不能说是面向对象编程，因为，还没有实现类的继承，只实现了类的创建实例。下面情景五来探讨如何继承类。</p>
<p><strong>情景五：</strong></p>
<p>不推荐用原生的写法进行面向对象编程，因为确实非常麻烦，推荐使用 coffeescript 进行面向对象的编程，甚至所有的 javascript 的编写，能转 coffeescript 就全部转，你会发现，使用 coffeescript 写出来的代码非常的优雅，而且，你将全部精力投入的是如何巧妙的设计代码，而不是堆代码的时代。</p>
<p>当然，这里还是会讲讲如何通过原生 javascript 的方式实现 javascript 的继承。不过，真的很麻烦。</p>
<p>首先，得要一个 extends，把它看成 new 级别的东西吧。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> __extends = <span class="function"><span class="keyword">function</span><span class="params">(child,father)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> property <span class="keyword">in</span> father) &#123;</span><br><span class="line">    child[property] = father[property];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Animal = <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">Animal.sayHello = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Hello "</span>+<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Cat = <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">__extends(Cat,Animal);</span><br><span class="line">Cat.sayHello();</span><br></pre></td></tr></table></figure>
<p>这是一种继承的方式，要完美实现，这还是不足的。代码量好大啊。还是使用 coffeescript 来写吧。</p>
<p><strong>情景六：</strong></p>
<p>在情景五中，Cat 继承了 Animal 的 sayHello 的方法。但是，如果改成 Animal.prototype.sayHello = function () {} 的话，Cat 类就没法继承了，这就是上面那种简单写法的缺陷。</p>
<p>所以需要把 prototype 的属性也要继承，所以必须把 __extends 函数重新写，注意 prototype 对于所有其派生类都是指向同一个内存空间的，修改父类对象的 prototype 将影响所有的子类。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> __extends = <span class="function"><span class="keyword">function</span><span class="params">(child,father)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> property <span class="keyword">in</span> father) &#123;</span><br><span class="line">    child[property] = father[property];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ctor</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">this</span>.constructor = child; </span><br><span class="line">  &#125; </span><br><span class="line">  ctor.prototype = parent.prototype; </span><br><span class="line">  child.prototype = <span class="keyword">new</span> ctor(); </span><br><span class="line">  child.__super__ = father.prototype; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很麻烦是吧，而且也不知道会不会出错。那您也应该尝试 coffeescript 的写法了。</p>
<p><strong>情景七：</strong></p>
<p>所以，还是来试试coffeescript的写法吧</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Animal</span><br><span class="line">  constructor:(@name) -&gt;</span><br><span class="line">  sayHello:-&gt;</span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"Hello #&#123;this.name&#125;."</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">class</span> Cat extends Animal</span><br><span class="line">  sayHello:-&gt;</span><br><span class="line">  <span class="built_in">console</span>.log <span class="string">"喵喵喵喵喵喵，#&#123;this.name&#125;"</span></span><br><span class="line"><span class="keyword">class</span> Dog extends Animal</span><br><span class="line">  sayHello:-&gt;</span><br><span class="line">  <span class="built_in">console</span>.log <span class="string">"汪汪汪汪汪汪，#&#123;this.name&#125;"</span></span><br><span class="line">cat1 = <span class="keyword">new</span> Cat <span class="string">"kitty"</span></span><br><span class="line">dog1 = <span class="keyword">new</span> Don <span class="string">"哈士奇"</span></span><br></pre></td></tr></table></figure>
<p>通过 coffeescript 写出一个 javascript 对象继承，代码就是这么简洁。</p>
<p>在这里面，就定义了 Animal 类，还有派生类 Cat 和 Dog，分别覆盖了父类的 sayHello 的方法。写完之后，直接使用 <a href="http://koala-app.com/" target="_blank" rel="external">koala</a>编译一下，马上一段完美的继承代码生成了。</p>
<p><strong>结语：</strong></p>
<p>至此，此片面向对象的文章算是草草结束了，断断续续写了一个星期，就写成了这样子，比较糟糕。大家不妨看看下面的参考文献。</p>
<p><strong>参考文献：</strong></p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new" title="new operator" target="_blank" rel="external">new</a></li>
<li><a href="http://developer.51cto.com/art/200907/134913.htm" title="javascript类和继承" target="_blank" rel="external">JavaScript类和继承：constructor属性</a></li>
<li><a href="http://koala-app.com/" title="koala" target="_blank" rel="external">koala</a></li>
<li><a href="http://coffeescript.org/" title="coffeescript" target="_blank" rel="external">coffeescript</a></li>
</ol>
<p>觉得对您有帮助，点个赞。赞赞更健康。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><strong>前言：</strong></p>
<p>下面将探讨 javascript 面向对象编程的知识。</p>
<p>请不要刻意把 javascript 想成面向对象编程是理所当然的。<br>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[探讨 css 中 repaint 和 reflow]]></title>
    <link href="http://shenqihui.github.io/2014/02/12/%E6%8E%A2%E8%AE%A8css%E4%B8%ADrepaint%E5%92%8Creflow/"/>
    <id>http://shenqihui.github.io/2014/02/12/探讨css中repaint和reflow/</id>
    <published>2014-02-11T21:47:00.000Z</published>
    <updated>2015-05-12T15:54:50.000Z</updated>
    <content type="html"><![CDATA[<p><strong>前言：</strong></p>
<p>页面设计中，不可避免的需要浏览器进行 repaint 和 reflow 。那到底什么是 repaint 和 reflow 呢。下面谈谈自己对 repaint 和 reflow 的理解，以及结合其他技术牛的讲解，谈谈如何优化 repaint 和 reflow 。<br><a id="more"></a><br><strong>初步介绍：</strong></p>
<p>开发一个页面时，不可避免的需要进行 repaint 和 reflow 。也就只有古来的静态页面才会不存在 repaint 和 reflow 。 repaint 主要是针对某一个 DOM 元素进行的重绘， reflow 则是回流，针对整个页面的重排。字面意思来说： repaint 就是重绘， reflow 就是回流。 repaint 和 reflow 的目的是：展示一个新的页面样貌。</p>
<p><strong>严重性：</strong></p>
<p>在性能优先的前提下，性能消耗  reflow 大于 repaint 。</p>
<p><strong>体现：</strong></p>
<p> repaint 是某个 DOM 元素进行重绘； reflow 是整个页面进行重排，也就是页面所有 DOM 元素渲染。</p>
<p><strong>如何触发：</strong></p>
<p> style 变动造成 repaint 和 reflow 。</p>
<p>不涉及任何 DOM 元素的排版问题的变动为 repaint ，例如元素的 color / text - align / text - decoration 等等属性的变动。</p>
<p>除上面所提到的 DOM 元素 style 的修改基本为 reflow 。例如元素的任何涉及长、宽、行高、边框、 display 等 style 的修改。</p>
<p><strong>常见触发场景：</strong></p>
<ol>
<li><p>触发 repaint ：</p>
<ol>
<li>color 的修改，如 color =# ddd ；</li>
<li>text - align 的修改，如 text - align = center ；</li>
<li>a : hover 也会造成重绘。</li>
<li>: hover 引起的颜色等不导致页面回流的 style 变动。</li>
<li>等等太多，一时间写出来也太难想了。</li>
</ol>
</li>
<li><p>触发 reflow ：</p>
<ol>
<li>width / height / border / margin / padding 的修改，如 width =778 px ；</li>
<li>动画，: hover 等伪类引起的元素表现改动， display = none 等造成页面回流；</li>
<li>appendChild 等 DOM 元素操作；</li>
<li>font 类 style 的修改；</li>
<li>background 的修改，注意着字面上可能以为是重绘，但是浏览器确实回流了，经过浏览器厂家的优化，部分 background 的修改只触发 repaint ，当然 IE 不用考虑；</li>
<li>scroll 页面，这个不可避免；</li>
<li>resize 页面，桌面版本的进行浏览器大小的缩放，移动端的话，还没玩过能拖动程序， resize 程序窗口大小的多窗口操作系统。</li>
<li>读取元素的属性（这个无法理解，但是技术达人是这么说的，那就把它当做定理吧）：读取元素的某些属性（ offsetLeft 、 offsetTop 、 offsetHeight 、 offsetWidth 、 scrollTop / Left / Width / Height 、 clientTop / Left / Width / Height 、 getComputedStyle ()、 currentStyle ( in   IE ))；</li>
</ol>
</li>
</ol>
<p><strong>如何避免：</strong></p>
<p>说避免那是不可能的，不然就是以前古老的静态页面了，没有交互，那在现在看来，就是一个失败的作品。所以，在我们进行网页设计的时候，就必须尽量减少页面的 repaint 和 reflow 。 repaint 和 reflow 的目的是为了展示一个新的页面，那么我们在进行页面交互时，尽量通过各种方法减少 repaint 和 reflow 但又能展示一个新的页面的目的。所以下面将结合其他技术达人的建议，通过自己的理解，给大家讲解如何避免和优化 repaint 和 reflow ：</p>
<p>下面是大神 Nicole   Sullivan 的原话：</p>
<blockquote>
<ol>
<li>Change   classes   on   the   element   you   wish   to   style  ( as   low   in   the   dom   tree   as   possible )</li>
<li>Avoid   setting   multiple   inline   styles </li>
<li>Apply   animations   to   elements   that   are   position   fixed   or   absolute </li>
<li>Trade   smoothness   for   speed </li>
<li>Avoid   tables   for   layout </li>
<li>Avoid   JavaScript   expressions   in   the   CSS ( IE   only )</li>
</ol>
</blockquote>
<ol>
<li><strong>尽可能在 DOM 末梢通过改变 class 来修改元素的 style 属性</strong>：尽可能的减少受影响的 DOM 元素。</li>
<li><strong>避免设置多项内联样式</strong>：使用常用的 class 的方式进行设置样式，以避免设置样式时访问 DOM 的低效率。</li>
<li><strong>设置动画元素 position 属性为 fixed 或者 absolute </strong>：由于当前元素从 DOM 流中独立出来，因此受影响的只有当前元素，元素 repaint 。</li>
<li><strong>牺牲平滑度满足性能</strong>：动画精度太强，会造成更多次的 repaint / reflow ，牺牲精度，能满足性能的损耗，获取性能和平滑度的平衡。</li>
<li><strong>避免使用 table 进行布局</strong>： table 的每个元素的大小以及内容的改动，都会导致整个 table 进行重新计算，造成大幅度的 repaint 或者 reflow 。改用 div 则可以进行针对性的 repaint 和避免不必要的 reflow 。</li>
<li><strong>避免在 CSS 中使用运算式</strong>：学习 CSS 的时候就知道，这个应该避免，不应该加深到这一层再去了解，因为这个的后果确实非常严重，一旦存在动画性的 repaint / reflow ，那么每一帧动画都会进行计算，性能消耗不容小觑。</li>
</ol>
<p><strong>参考文献：</strong></p>
<ol>
<li><a href="http :// www . blueidea . com / tech / web /2011/8365. asp" title=" http :// www . blueidea . com / tech / web /2011/8365. asp ">页面重构应注意的 repaint 和 reflow </a></li>
<li><a href="http :// blog . csdn . net / baiduforum / article / details /5415527" title="如何减少浏览器 repaint 和 reflow （上）">如何减少浏览器 repaint 和 reflow （上）</a></li>
<li><a href="http :// www . zhangxinxu . com / wordpress /2010/01/% E 5%9 B %9 E % E 6% B 5%81% E 4% B 8%8 E % E 9%87%8 D % E 7% BB %98% EF % BC %9 Acss % E 6%80% A 7% E 8%83% BD % E 8% AE % A 9 javascript % E 5%8 F %98% E 6%85% A 2% EF % BC %9 F /" title="回流与重绘： CSS 性能让 JavaScript 变慢？">回流与重绘： CSS 性能让 JavaScript 变慢？</a></li>
<li><a href="http :// www . stubbornella . org / content /2009/03/27/ reflows - repaints - css - performance - making - your - javascript - slow /" title=" Permanent   Link :  Reflows  &amp; amp ;  Repaints :  CSS   Performance   making   your   JavaScript   slow ?"> Reflows  &amp; amp ;  Repaints :  CSS   Performance   making   your   JavaScript   slow ?</a></li>
</ol>
<p>觉得有用，点个赞，赞赞更健康。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><strong>前言：</strong></p>
<p>页面设计中，不可避免的需要浏览器进行 repaint 和 reflow 。那到底什么是 repaint 和 reflow 呢。下面谈谈自己对 repaint 和 reflow 的理解，以及结合其他技术牛的讲解，谈谈如何优化 repaint 和 reflow 。<br>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[汤姆大叔设计模式学习体会：设计模式的思想]]></title>
    <link href="http://shenqihui.github.io/2014/02/08/%E6%B1%A4%E5%A7%86%E5%A4%A7%E5%8F%94%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0%E4%BD%93%E4%BC%9A%EF%BC%9A%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%80%9D%E6%83%B3/"/>
    <id>http://shenqihui.github.io/2014/02/08/汤姆大叔设计模式学习体会：设计模式的思想/</id>
    <published>2014-02-08T00:32:00.000Z</published>
    <updated>2015-05-12T15:57:11.000Z</updated>
    <content type="html"><![CDATA[<p><strong>汤姆大叔的教程地址：<a href="http://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html" target="_blank" rel="external">http://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html</a>，谢谢大叔。</strong></p>
<p><strong>1、单例模式</strong></p>
<p>核心是该对象只存在一个实例，要么直接写成实例的形式，</p>
<p>要么就需要写成构造函数形式，但是需要在构造函数里面通过模拟闭包的方式重新定义该构造函数，保存当前this对象，新定义的构造函数返回该this对象，达到只存在改对象只存在一个实例的目的。<br><a id="more"></a><br><strong>2、构造者模式</strong></p>
<p>其实就一构造函数，记得首字母大写。</p>
<p><strong>3、建造者模式</strong></p>
<p>给你一块砖，你能砌上墙，给你十块砖，也能通过这个方法砌上墙。可能这些砖的颜色有点不同而已。这个方法，就是建造者模式。</p>
<p>砖的颜色怎么样，墙就怎么样，跟怎么建造没关系。给你同类型的砖，这个方法就能砌好这堵墙。</p>
<p><strong>4、工厂模式</strong></p>
<p>一个有钱的傻大壮，有一天看到想要一个三轮车，他爸给了他个能做任何车的车厂。</p>
<p>傻大壮跟厂长说：“给我个帅气的三轮车”，铛的一声，厂长给了他一辆自己厂生产的三轮车。</p>
<p>又一天，傻大壮想要一个拖拉机，厂长二话没说，拉出了刚下生产线的拖拉机。</p>
<p>傻大壮耍了几天，觉得拖拉机太快了，根厂长要量人力三轮车，厂长吩咐阿四把刚出产的人力三轮车骑了过来。</p>
<p>傻大壮要去泡妞啊，厂长觉得三轮车去泡妞太霸气了，要低调，哄傻大壮开个别的。傻大壮说：“那好，给我个法拉利”。 厂长笑了笑，又叫阿四拉出了最新研发的法拉利出来。</p>
<p>这个就是工厂，这个工厂就是一个模式，给什么要求，做什么东西，当然，你说飞机火箭什么的，劳驾到其它工厂吧。</p>
<p>不过嘛，你没有傻大壮的老爸，这个工厂需要你自己来搭建咯，先从自行车的刹车皮开始做起吧，慢慢来别急啊骚年。</p>
<p><strong>5、装饰者模式</strong></p>
<p>傻大壮一直有一个理念，只买贵的不买对的。</p>
<p>一天他朋友跟他说，他的劳斯莱斯改装过之后，价值比原来高了100快啊，然后又加了个高压发动机，价值又高了200快。总价从原来的400快变成700了。</p>
<p>傻大壮开不过眼，自己的法拉利再怎么说也是600快的价值，我也要改装，超过你们，结果傻大壮把车拿去改装：喷靓丽的骚红色车漆，价值+100、改装亮瞎前灯，价值+200，傻大壮觉得，反正已经900快价值了，比你的高。</p>
<p>这就是装饰者模式，把原车拿去，换了一个改装过的车。再把这车改装，这车又更加霸气了。不过来来回回都是那个车每一次改装都没有前提和前置条件。不过大叔的代码里面，前面的代码说的确实每一次的车都被克隆了一个，把克隆了之后的给了别人。后面使用了prototype才算正确。（个人疑惑点，大叔见谅，谢谢大叔指点。）</p>
<p><strong>6、外观模式</strong></p>
<p>将相同功能但是参数顺序数量格式不同或者功能名不同的功能集合起来，通过该功能即可自动识别调用该系统支持的接口，鉴于每次都需要进行支持性判断，损耗了部分的性能。但是大大方便了程序员的工作，大部分兼容框架都会使用到该模式。如下事件绑定代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addMyEvent = <span class="function"><span class="keyword">function</span> <span class="params">(el, ev, fn)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (el.addEventListener) &#123;</span><br><span class="line">        el.addEventListener(ev, fn, <span class="literal">false</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.attachEvent) &#123;</span><br><span class="line">        el[<span class="string">'e'</span>+ev+fn]=fn;</span><br><span class="line">        el[ev+fn]=<span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>&#123;el[<span class="string">'e'</span>+ev+fn](e||<span class="built_in">window</span>.event);&#125;</span><br><span class="line">        el.attachEvent(<span class="string">'on'</span> + ev, el[ev+fn]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        el[<span class="string">'e'</span>+ev+fn]=fn;</span><br><span class="line">        el[ev+fn]=<span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>&#123;el[<span class="string">'e'</span>+ev+fn](e||<span class="built_in">window</span>.event);&#125;</span><br><span class="line">        el[<span class="string">'on'</span> + ev] = el[ev+fn];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>7、代理模式</strong></p>
<p>大叔说了，dudu不敢送玫瑰花给酸奶小妹，大叔就帮他了。常用，不过把自己的命运交给别人把握的感觉不怎么好。</p>
<p><strong>8、观察者模式</strong></p>
<p>对于消息分发很有帮助，能通过一个地方的修改就改变其他地方。具体实现代码的时候直接模仿。</p>
<p><strong>9、策略模式</strong></p>
<p>把算法单独封装起来，区别于每次使用不使用这种模式构造的算法集都会影响用户使用。使用该种模式的话，能够方便的进行功能增加的测试，新增加的同类算法不影响现在的算法，大叔的文章中把输入验证的算法单独抽出实现算法集的集合，增加新验证方式又不影响现在算法。</p>
<p><strong>10、命令模式</strong></p>
<p>这个模式十分适合那种需要记录动作执行记录的功能，讲这个命令接口设置成字符串或者JSON格式，传输给命令接口，即可方便执行命令记录和执行命令的动作。命令格式还能自定义。</p>
<p><strong>11、迭代器模式</strong></p>
<p>主要思想是把一个属性不可修改的可遍历的聚合对象保护起来，在进行遍历时，需要采用该种模式。</p>
<p>该模式中，通过至少hasNext()和Next()两个方法，即可进行把一个聚合对象的所有可遍历属性遍历完毕。</p>
<p><strong>12、中介者模式</strong></p>
<p>使用中介封装其他对象的交互。大叔说道，中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。</p>
<p>耦合松散对编程来说那可是值得走的好方向，只是需要花点时间来解耦而已。</p>
<p>中介者模式和观察者模式有相同之处，都是通过消息驱动，用户出发一个对象的事件，传输到中介者，中介者分发下去，触发接受者的接受函数。其实我把两者混淆了。</p>
<p>重要特点是，中介者，多对多；观察者，一对多。</p>
<p><strong>13、享元模式</strong></p>
<p>方便的管理相同的层级元素。例如具备相同单元的对象及元素，能把其相同之处集合起来。还有管理 DOM 事件，利用 DOM 的冒泡和捕抓事件的特性。能把单独的小事件统一到其上一级别，通过判断 e.originalTarget 或者 e.srcElement 进行小事件的对应单独处理，但是要注意多次触发事件的问题。达到性能和内存的优化。</p>
<p><strong>14、职责链模式</strong></p>
<p>职责链就好像工厂的生产流水线，每到一个责任，都会有一个特定的接口，调用该接口就能自动通知下一任责任者就行责任的填充，每一个责任都知道其下一任职责者。最后一任职责者会调用完毕动作。</p>
<p>因此在使用职责链时，需要传入下一任职责者，生成对象，调用职责链的公用方法，通知下一任职责者。创建处事对象的时候，需要根据职责链的接口，设定动作函数。</p>
<p><strong>15、适配器模式</strong></p>
<p>该模式主要针对接口的改变，如果不想再原始对象上面进行变动，那就可以采取适配器的模式。把原有接口重新封装，实现用户需要的接口。</p>
<p>就比如一个三口插座充电器，在中国能用，在外国不能用了，就需要使用接口转换的了，现在的高端手机基本上都有多口转换。充电器到头来还是那个充电器。</p>
<p><strong>16、组合模式</strong></p>
<p>大叔说道，组合模式有明确的使用场景：1、你想表达对象的部分-整体层次结构时。2、组合对象和单个对象不同，但是使用的时候能相同使用。具体实现时需要先写一个最基础的组合方法，然后后面的单个对象的基础对象都需要继承该方法。详细实现时，参考大叔的菜单代码。</p>
<p><strong>17、模板方法</strong></p>
<p>思想：创建一个框架，搭建框架的所有方法，但是只实现相同功能，可变功能只留接口不实现，留在子类实现。</p>
<p>该框架能够延森到其它子类中，具体功能将在子类实现时补充完毕。</p>
<p><strong>18、原型模式</strong></p>
<p>这个模式比较通用，通过javascript特有的原型继承实现继承方法都会使用到该种模式。ECMA5中的是使用Odject.create方法实现原型继承。大叔提到需要注意深拷贝和浅拷贝的问题。值引用方式为浅拷贝，值返回的方式是深拷贝。</p>
<p><strong>19、状态模式</strong></p>
<p>代码很多的一篇，一个模式足足200行。</p>
<p>使用该种模式有明确场景：</p>
<p>对象的行为跟对象的状态相关，运行时刻，状态改变讲改变对象的行为，对象的行为根据状态进行。</p>
<p>写这种代码确实是劳心劳力啊。T_T||。详细实现的时候再瞧瞧大叔的代码吧。</p>
<p><strong>20、桥接模式</strong></p>
<p>最简单的桥接模式，把一个可能在不同上下文下不能运行的函数，通过改变调用方式或者改变参数的方式达到运行的目的。这个方式就成为桥。</p>
<p>大叔的例子里面，代码是运行不鸟了，因为没有环境。主要思想就是在绑定动作的时候，直接的实现内容用户可以不知道，传输正确参数（如id）进去即可判断参数进行动作或者获取数据。</p>
<p><strong>总结：</strong></p>
<p>花了一个春节假期，把大叔的设计模式这一块看完了，从编码思想方面进行了改变。但是，设计模式并非看完就能真正掌握了，没有实践，永远只能在口中胡扯。</p>
<p>talk is cheap,show me the code.</p>
<p>速成设计模式，难，没基础学设计模式，难。学习设计模式的最佳方法不是看书就知道，而是看过了书知道，了解到其思想，在自己的编码实践中，结合进去，参考前人的代码进行该模式的实现，自然水到渠成。</p>
<p>这就是这篇文章的目的：设计模式的思想。</p>
<p>（并非做了精读，只做编程作参考，如有错误，恳请大力指出，谢谢。）</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><strong>汤姆大叔的教程地址：<a href="http://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html">http://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html</a>，谢谢大叔。</strong></p>
<p><strong>1、单例模式</strong></p>
<p>核心是该对象只存在一个实例，要么直接写成实例的形式，</p>
<p>要么就需要写成构造函数形式，但是需要在构造函数里面通过模拟闭包的方式重新定义该构造函数，保存当前this对象，新定义的构造函数返回该this对象，达到只存在改对象只存在一个实例的目的。<br>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[从一道数学题弹程序员的思维：数学题，求证：(a+b%c)%c=(a+b)%c]]></title>
    <link href="http://shenqihui.github.io/2014/02/08/%E4%BB%8E%E4%B8%80%E9%81%93%E6%95%B0%E5%AD%A6%E9%A2%98%E5%BC%B9%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%80%9D%E7%BB%B4%EF%BC%9A%E6%95%B0%E5%AD%A6%E9%A2%98%EF%BC%8C%E6%B1%82%E8%AF%81%EF%BC%9A-a-b-c-c-a-b-c/"/>
    <id>http://shenqihui.github.io/2014/02/08/从一道数学题弹程序员的思维：数学题，求证：-a-b-c-c-a-b-c/</id>
    <published>2014-02-07T19:36:00.000Z</published>
    <updated>2015-05-12T15:37:13.000Z</updated>
    <content type="html"><![CDATA[<p>在学校论坛看到这道题目，全忘了的感觉。</p>
<p>如果你是高中的，那我觉得你完全没问题。但是，在这个博客园的圈子，觉得全部人都是程(ban)序(zhuan)员(gong)相关的人员，解决这个问题有点难度，毕竟，想法已经偏了。</p>
<a id="more"></a>
<p>有句话说得好，如果你拿着一个锤子，那你看什么都像一个钉子。</p>
<p>因此程序员必要的时候必须转换下思路啊。程序员思维是：已知条件，求值；而不是已知 条件 和 值，求证：这求值过程不存在bug。</p>
<p>如果有人叫你这么证明你的程序的求值过程正确，你会不会抡起你的键(zhuan)盘(tou)就拍过去了。</p>
<p>我们能做到的只是，代入 <code>a=*,b=**,c=***</code>，验证等式成立。数学题让数学家证明去吧。</p>
<p>下面回到高中的想法，谈谈这道题目吧：</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">求证：<span class="comment">(a+b%c)</span><span class="preprocessor">%</span>c=<span class="comment">(a+b)</span><span class="preprocessor">%</span>c</span><br><span class="line">解：</span><br><span class="line"></span><br><span class="line">　　假设等式左右边的值为 v，</span><br><span class="line"></span><br><span class="line">　　则 存在整数x和y，使得下面等式成立。</span><br><span class="line"></span><br><span class="line">　　a+b<span class="preprocessor">%</span>c = v + xc;（左边）</span><br><span class="line"></span><br><span class="line">　　a+b     = v + yc;（右边）</span><br><span class="line"></span><br><span class="line">　　这两式子同时成立，则可以化简为：</span><br><span class="line"></span><br><span class="line">　　存在整数 z 使得 z*c = b - b<span class="preprocessor">%</span>c 成立。</span><br><span class="line"></span><br><span class="line">　　则证明 b - b<span class="preprocessor">%</span>c 为 c 的倍数。</span><br><span class="line"></span><br><span class="line">　　显然 b - b<span class="preprocessor">%</span>c 为 c 的倍数。</span><br></pre></td></tr></table></figure>
<p>（感觉我自己也跑歪了，如果(b - b%c 为 c 的倍数)不是显然的话，我们还做什么程序员。其实 (a+b%c)%c=(a+b)%c 也是显然的。）</p>
<p>后注：发表了出来，才发现，其实这道题跟程序员思维没啥联系。纯当胡扯。</p>
<p>下面是整理某网友 <a href="http://home.cnblogs.com/u/228024/" target="_blank" rel="external">五岳</a> 提供的正确方法，谢谢指导。（我的答案已经跑歪了）</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">假设：</span><br><span class="line">　　a = x*<span class="built_in">c</span> + a0</span><br><span class="line">　　b = y*<span class="built_in">c</span> + b0</span><br><span class="line">　　其中x,y,a0,b0∈<span class="type">Z</span>,且|a0|&lt;|<span class="built_in">c</span>|,|b0|&lt;|<span class="built_in">c</span>|</span><br><span class="line">　　那么</span><br><span class="line">　　(a+b%<span class="built_in">c</span>)%<span class="built_in">c</span> = (x*<span class="built_in">c</span> + a0 + (y*<span class="built_in">c</span> + b0)%<span class="built_in">c</span>)=(x*<span class="built_in">c</span> +a0 + b0)%<span class="built_in">c</span> = (a0 + b0)%<span class="built_in">c</span></span><br><span class="line">　　而(a+b)%<span class="built_in">c</span> = (x*<span class="built_in">c</span> + a0 + y*<span class="built_in">c</span> + b0)%<span class="built_in">c</span> = (a0+b0)%<span class="built_in">c</span></span><br><span class="line">　　两式相等，得证</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>在学校论坛看到这道题目，全忘了的感觉。</p>
<p>如果你是高中的，那我觉得你完全没问题。但是，在这个博客园的圈子，觉得全部人都是程(ban)序(zhuan)员(gong)相关的人员，解决这个问题有点难度，毕竟，想法已经偏了。</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[汤姆大叔 深入理解JavaScript系列（20）：《你真懂JavaScript吗？》答案详解 后六道题答案]]></title>
    <link href="http://shenqihui.github.io/2014/02/03/%E6%B1%A4%E5%A7%86%E5%A4%A7%E5%8F%94-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JavaScript%E7%B3%BB%E5%88%97%EF%BC%8820%EF%BC%89%EF%BC%9A%E3%80%8A%E4%BD%A0%E7%9C%9F%E6%87%82JavaScript%E5%90%97%EF%BC%9F%E3%80%8B%E7%AD%94%E6%A1%88%E8%AF%A6%E8%A7%A3-%E5%90%8E%E5%85%AD%E9%81%93%E9%A2%98%E7%AD%94%E6%A1%88/"/>
    <id>http://shenqihui.github.io/2014/02/03/汤姆大叔-深入理解JavaScript系列（20）：《你真懂JavaScript吗？》答案详解-后六道题答案/</id>
    <published>2014-02-03T07:00:00.000Z</published>
    <updated>2015-05-12T15:33:55.000Z</updated>
    <content type="html"><![CDATA[<p>原题目地址：<a href="http://www.cnblogs.com/TomXu/archive/2012/02/10/2342098.html" target="_blank" rel="external">http://www.cnblogs.com/TomXu/archive/2012/02/10/2342098.html</a></p>
<p>答案丰富多彩。我只是记录下自己思考了半天全部的答案。<br><a id="more"></a><br>&nbsp;</p>
<p><strong>题目一：找出数字数组中最大的元素（使用Match.max函数）</strong></p>
<p>这个题目，看到Match，不知道啥东西，结果放在最后，</p>
<p>用了个很笨的解决方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>],arrFunc = [], max = -<span class="literal">Infinity</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, l = arr.length; i &lt; l; i++)&#123;</span><br><span class="line">  max = <span class="built_in">Math</span>.max(max,arr[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(max);</span><br></pre></td></tr></table></figure>
<p>后来看了下原文评论，原来这么简单。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.max.apply(<span class="literal">null</span>,arr))</span><br></pre></td></tr></table></figure>
<p>这个问题就没啥好解析的了。</p>
<p><strong>题目二：转化一个数字数组为function数组（每个function都弹出相应的数字）</strong></p>
<p>for循环闭包的问题，大叔的文章很多提到这个问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>],arrFunc = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, l = arr.length; i &lt; l; i++)&#123;</span><br><span class="line">  arrFunc.push((<span class="function"><span class="keyword">function</span><span class="params">(i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)(i))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>个人觉得对于闭包最简单的解析：闭包的作用就是保存当前的作用链域的环境。</p>
<p><strong>题目三：给object数组进行排序（排序条件是每个元素对象的属性个数）</strong></p>
<p>这个说起来好像很坑爹的赶脚。我居然用了这么笨的想法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.myLength = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> length = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> <span class="keyword">this</span>)&#123;</span><br><span class="line">    length ++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> objArr = [</span><br><span class="line">  &#123;a:<span class="number">1</span>, b:<span class="number">2</span>, c:<span class="number">5</span>, d:<span class="number">7</span>, e:<span class="number">8</span>, g:<span class="number">0</span>, h:<span class="number">12</span>, i:<span class="number">5</span>, v:<span class="number">9</span>, w:<span class="number">9</span>, x:<span class="number">9</span>, y:<span class="number">9</span>, z: <span class="number">15</span>&#125;,</span><br><span class="line">  &#123;a:<span class="number">2</span>, b:<span class="number">2</span>, c:<span class="number">5</span>, d:<span class="number">7</span>, e:<span class="number">8</span>, g:<span class="number">0</span>, h:<span class="number">12</span>, i:<span class="number">5</span>, j:<span class="number">7</span>, k:<span class="number">5</span>, l:<span class="number">9</span>, m:<span class="number">9</span>, n:<span class="number">0</span>, o:<span class="number">1</span>, p:<span class="number">9</span>, x:<span class="number">9</span>, y:<span class="number">9</span>, z:<span class="number">9</span> &#125;, </span><br><span class="line">  &#123;a:<span class="number">3</span>, b:<span class="number">2</span>, c:<span class="number">5</span>, d:<span class="number">7</span>, e:<span class="number">8</span>, g:<span class="number">0</span>, h:<span class="number">12</span>, i:<span class="number">5</span>, j:<span class="number">7</span>, k:<span class="number">5</span>, l:<span class="number">9</span>, m:<span class="number">9</span>, n:<span class="number">0</span>, o:<span class="number">1</span>, p:<span class="number">9</span>, q:<span class="number">0</span> &#125;,</span><br><span class="line">  &#123;a:<span class="number">4</span>, b:<span class="number">2</span>, c:<span class="number">5</span>, d:<span class="number">7</span>, e:<span class="number">8</span>, g:<span class="number">0</span>, h:<span class="number">12</span>, i:<span class="number">5</span>, j:<span class="number">7</span>, k:<span class="number">5</span>, w:<span class="number">9</span>, x:<span class="number">9</span>, y:<span class="number">9</span>, z:<span class="number">9</span> &#125;,</span><br><span class="line">  &#123;a:<span class="number">5</span>, b:<span class="number">2</span>, c:<span class="number">5</span>, d:<span class="number">7</span>, e:<span class="number">8</span>, g:<span class="number">0</span>, h:<span class="number">12</span>, i:<span class="number">5</span>, j:<span class="number">7</span>, k:<span class="number">5</span>, v:<span class="number">9</span>, w:<span class="number">9</span>, x:<span class="number">9</span>, y:<span class="number">9</span>, z:<span class="number">9</span> &#125;,</span><br><span class="line">  &#123;a:<span class="number">6</span>, b:<span class="number">2</span>, c:<span class="number">5</span>, d:<span class="number">7</span>, e:<span class="number">8</span>, g:<span class="number">0</span>, h:<span class="number">12</span>, i:<span class="number">5</span>, j:<span class="number">7</span>, k:<span class="number">5</span>, l:<span class="number">9</span>, m:<span class="number">9</span>, n:<span class="number">0</span>, o:<span class="number">1</span>, p:<span class="number">9</span>, q:<span class="number">0</span>, r:<span class="number">8</span>, s:<span class="number">9</span>, t:<span class="number">9</span>, z:<span class="number">9</span> &#125;,</span><br><span class="line">  &#123;a:<span class="number">7</span>, b:<span class="number">2</span>, c:<span class="number">5</span>, d:<span class="number">7</span>, e:<span class="number">8</span>, x:<span class="number">9</span>, y:<span class="number">9</span>, z:<span class="number">9</span> &#125;</span><br><span class="line">];</span><br><span class="line"><span class="comment">// arr before sort</span></span><br><span class="line"><span class="keyword">var</span> numArr1 = []</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, l = objArr.length; i &lt; l; i++ )&#123;</span><br><span class="line">  numArr1.push( objArr[i].myLength() )</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(numArr1.join(<span class="string">" "</span>)) <span class="comment">//result</span></span><br><span class="line"><span class="comment">// arr after sort</span></span><br><span class="line">objArr.sort(<span class="function"><span class="keyword">function</span><span class="params">(a,b)</span></span>&#123;</span><br><span class="line">  <span class="comment">// stable sort</span></span><br><span class="line">  <span class="comment">// return (a.myLength() &gt; b.myLength()) === true? 1:-1;</span></span><br><span class="line">  <span class="comment">// unstable sort</span></span><br><span class="line">  <span class="keyword">return</span> (a.myLength() &gt;= b.myLength()) === <span class="literal">true</span>? <span class="number">1</span>:-<span class="number">1</span>;</span><br><span class="line">  <span class="comment">// return a.myLength() - b.myLength();</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> numArr2 = []</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, l = objArr.length; i &lt; l; i++ )&#123;</span><br><span class="line">  <span class="comment">// console.log(i,l,objArr[i].myLength());</span></span><br><span class="line">  numArr2.push( objArr[i].myLength() )</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(numArr2.join(<span class="string">" "</span>)) <span class="comment">//result</span></span><br></pre></td></tr></table></figure>
<p>感觉突然自己的想法和别人的有点不同（不好的方向）。</p>
<p><strong>题目四：利用JavaScript打印出Fibonacci数（不使用全局变量）</strong></p>
<p>这个问题，写完之后我看了下其他人的写法，一半一半都没写中间缓存保存，我觉得这也是大叔表明不适用全局变量的原因，我把两种方式都写了进去。</p>
<p>这个是有缓存的，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fibonacci = (<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> s = [];</span><br><span class="line">  <span class="keyword">var</span> fun = <span class="function"><span class="keyword">function</span><span class="params">(x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s[x])&#123;</span><br><span class="line">      <span class="keyword">return</span> s[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="string">"Can't be negative"</span>;</span><br><span class="line">      <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x === <span class="number">0</span> || x === <span class="number">1</span>) &#123;</span><br><span class="line">      s[x] = s[x] || x;</span><br><span class="line">      <span class="keyword">return</span> s[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      s[x] = ( fun(x - <span class="number">1</span>) + fun(x - <span class="number">2</span>) );</span><br><span class="line">      <span class="keyword">return</span> s[x];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  fun.print = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(s.join(<span class="string">" "</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  fun.printLast = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(s.length);</span></span><br><span class="line">    <span class="keyword">return</span>(s[s.length-<span class="number">1</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">window</span>.s = s;</span><br><span class="line">  <span class="keyword">return</span> fun;</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br><span class="line"><span class="built_in">console</span>.time(<span class="number">200</span>);</span><br><span class="line"><span class="built_in">console</span>.log(fibonacci(<span class="number">200</span>));</span><br><span class="line"><span class="built_in">console</span>.log(fibonacci.printLast());</span><br><span class="line"><span class="built_in">console</span>.log(fibonacci.print());</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="number">200</span>);</span><br></pre></td></tr></table></figure>
<p>测试几百几千位的时间不足1000ms。</p>
<p>这个是递归无缓存的，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fibonacci2 = <span class="function"><span class="keyword">function</span><span class="params">(x)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(x &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">"Can't be negative"</span>;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(x === <span class="number">0</span> || x === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> num = ( fibonacci2(x - <span class="number">1</span>) + fibonacci2(x - <span class="number">2</span>) )</span><br><span class="line">  <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.time(<span class="number">32</span>);</span><br><span class="line"><span class="built_in">console</span>.log(fibonacci2(<span class="number">32</span>));</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="number">32</span>);</span><br></pre></td></tr></table></figure>
<p>测试个32位已经4000ms+，时间呈数量级增长，太坑。</p>
<p><strong>题目五：实现如下语法的功能：var a = (5).plus(3).minus(6); //2</strong></p>
<p>这个算是最简单的吧，但是我居然和别人的不一样，都能运行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.prototype.plus = <span class="function"><span class="keyword">function</span><span class="params">(x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> num = <span class="keyword">this</span>.valueOf() + x;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Number</span>(num);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Number</span>.prototype.minus = <span class="function"><span class="keyword">function</span><span class="params">(x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> num = <span class="keyword">this</span>.valueOf() - x;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Number</span>(num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = (<span class="number">5</span>).plus(<span class="number">3</span>).minus(<span class="number">6</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line">alert(a);</span><br></pre></td></tr></table></figure>
<p>人家直接返回一个num，我返回一个Number封装的num对象，其实都一样是Number对象。</p>
<p><strong>题目六：实现如下语法的功能：var a = add(2)(3)(4); //9</strong></p>
<p>这个题目算是第一个做出来的题目，因为我觉得这个题目的要求最简单，一看就记得，半夜睡醒了在床上直接脑袋打草稿运行了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mid;</span><br><span class="line">  mid = x || <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addObj</span><span class="params">(x)</span> </span>&#123;</span><br><span class="line">    x = x || <span class="number">0</span>;</span><br><span class="line">    mid = mid + x;</span><br><span class="line">    <span class="keyword">return</span> addObj;</span><br><span class="line">  &#125;</span><br><span class="line">  addObj.valueOf = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mid;</span><br><span class="line">  &#125;</span><br><span class="line">  addObj.toString = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mid;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> addObj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//call the obj.valueOf function</span></span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">2</span>));</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">2</span>)(<span class="number">3</span>));</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>));</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//call the obj.toString function</span></span><br><span class="line">alert(add(<span class="number">2</span>));</span><br><span class="line">alert(add(<span class="number">2</span>)(<span class="number">3</span>));</span><br><span class="line">alert(add(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>));</span><br><span class="line">alert(add(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>));</span><br></pre></td></tr></table></figure>
<p>能无限调用。</p>
<p>写完上述代码，我参考了下原文评论里面的，看了下自己的代码，和别人的比较下，有好的地方，也有不足之处，不过我的代码比较浅显，不想部分人写的那些看了很久才看明白，特别是那个写了缓存的fibonacci数列的答案。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>原题目地址：<a href="http://www.cnblogs.com/TomXu/archive/2012/02/10/2342098.html">http://www.cnblogs.com/TomXu/archive/2012/02/10/2342098.html</a></p>
<p>答案丰富多彩。我只是记录下自己思考了半天全部的答案。<br>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[canvas绘制自定义的曲线，以椭圆为例，通俗易懂，童叟无欺]]></title>
    <link href="http://shenqihui.github.io/2013/08/21/canvas%E7%BB%98%E5%88%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%9B%B2%E7%BA%BF%EF%BC%8C%E4%BB%A5%E6%A4%AD%E5%9C%86%E4%B8%BA%E4%BE%8B%EF%BC%8C%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%EF%BC%8C%E7%AB%A5%E5%8F%9F%E6%97%A0%E6%AC%BA/"/>
    <id>http://shenqihui.github.io/2013/08/21/canvas绘制自定义的曲线，以椭圆为例，通俗易懂，童叟无欺/</id>
    <published>2013-08-20T20:57:00.000Z</published>
    <updated>2015-05-12T15:27:30.000Z</updated>
    <content type="html"><![CDATA[<p>本篇文章，将讲述如何通过自定义的曲线函数，使用 canvas 的方式进行曲线的绘制。</p>
<p>为了通俗易懂，将以大家熟悉的椭圆曲线为例，进行椭圆的绘制。至于其他比较复杂的曲线，用户只需通过数学方式建立起曲线函数，然后变换成为距离函数方程，替换即可。另外：代码还没进行任何优化。<br><a id="more"></a><br>（注：本文只适合那种能在一个点为原点、基于原点的每个角度只能存在一个点的曲线，通俗说就是，过原点作直线，与曲线相交的交点最多两个，而且两交点分别位于原点两端。）</p>
<p>目录结构</p>
<p><a href="#hh1">1、数学分析</a></p>
<p><a href="#hh2">2、曲线方程</a></p>
<p><a href="#hh3">3、画一个点</a></p>
<p><a href="#hh4">4、画形状</a></p>
<p><a href="#hh5">5、废话</a></p>
<p>正文：</p>
<p>1、数学分析</p>
<p>首先讲解下椭圆的构造，如图所示，数学厉害的忽视这段。</p>
<p>========分割线，数学帝请忽略这一段========</p>
<p><img src="http://images.cnitblog.com/blog/358891/201308/21124416-9a3d72a50a4e4defb07b200019eba1f8.png" alt=""></p>
<p>椭圆构造图</p>
<p>其中，OA,OB分别为半长轴和短长轴，通过此两线段的距离能计算出半焦距FO的长度，再确定心O的坐标就能确认整个椭圆的范围。</p>
<p>由此可知，清楚了OA,OB的距离，就能知道椭圆的形状。</p>
<p><a href="http://baike.baidu.com/link?url=pbwLlXdKGl18oSg94MhDTzfi-http://baike.baidu.com/link?url=pbwLlXdKGl18oSg94MhDTzfi-s1HNoSmCs9EfZ3PeGy0hJSE0suePuZqvO7D92Zi" target="_blank" rel="external">百度百科</a>里面讲到，</p>
<blockquote>
<p>椭圆的标准方程有两种，取决于焦点所在的坐标轴：</p>
<p>1）焦点在X轴时，标准方程为：x&sup2;/a&sup2;+y&sup2;/b&sup2;=1 (a&gt;b&gt;0)</p>
<p>2）焦点在Y轴时，标准方程为：y&sup2;/a&sup2;+x&sup2;/b&sup2;=1 (a&gt;b&gt;0)</p>
</blockquote>
<p>其实两个概念差不多一样，将a 和 b在方程中的位置对调就行。不详细讲。</p>
<p>看好，我要变形了。 →_→</p>
<p>假设 θ 为 ∠POF，P 点距离 x 轴的长度为 Y<sub>1</sub> 的值，设为 y；距离 Y 轴长度为 X<sub>1</sub> 值，设为 X，P 点基于 O 的坐标就是 (x<sub>1</sub>,y<sub>1</sub>)。</p>
<p>tanθ = y/x</p>
<p>y = xtanθ</p>
<p>带入椭圆方程 x²/a²+x2(tanθ)2/b²=1 ，解得。(注：tanθ * tanθ ，不记得是用 tanθ²/tan²θ 表示了，貌似是 tan²θ，本文统一 ((tanθ)²) 表示)</p>
<p>x² = a²b² / (b²+a²(tanθ)²)，代入 y = xtanθ，并进行化简得出  x²+y² = (a²b²(1+(tanθ)²)/ (b²+a²(tanθ)²)，就是说，通过 a，b，θ; 能计算出 OP 的距离来了。</p>
<p>========分割线，忽略了上面段的可以回来了========</p>
<p>2、曲线方程</p>
<p>因此，得到一个方程，返回的是OP的距离</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">  func: </span><br><span class="line">        ellipseFunc:return the length</span><br><span class="line">  args:</span><br><span class="line">        a:[number] ellipse's a</span><br><span class="line">        b:[number] ellipse's b</span><br><span class="line">        theta:[number] how much of Math.PI</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ellipseFunc</span><span class="params">(a,b,theta)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// javascript Math对象下面的三角函数，传入的theta值必须是转换成弧度制的值，就是多少个3.141592…等等等的那个弧度制</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.pow(((a*a*b*b)*(<span class="number">1</span>+<span class="built_in">Math</span>.tan(theta)*<span class="built_in">Math</span>.tan(theta)))/(b*b+a*a*<span class="built_in">Math</span>.tan(theta)*<span class="built_in">Math</span>.tan(theta)),<span class="number">1</span>/<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、画一个点</p>
<p>既然曲线函数完毕，下面就行画图了，先从画一个点来说，网上很对关于描绘一个点的帖子，我选了 ctx. <a href="http://www.w3schools.com/tags/canvas_fillrect.asp" target="_blank" rel="external">fillRect</a> (x,y,a,b)，这是绘制矩形的函数，x、y 为绘制矩形的起点，就是左上角，设置 a=b=1 ，就能绘制一个长宽各为 1px 大小的矩阵，个人喜欢使用其他也行。 </p>
<p>下面是绘制一个点的函数，填充风格没有定义，在传入 _ctx 时是什么 <a href="http://www.w3school.com.cn/html5/canvas_fillstyle.asp" target="_blank" rel="external">fillStyle</a> 就填充什么风格。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">  func: </span><br><span class="line">        drawPoint:draw a point</span><br><span class="line">  args:</span><br><span class="line">        _ctx:[object]the canvas's getContent("2d") variable</span><br><span class="line">        point:[object] the point where to draw a dot such as &#123;"x":200,"y":200&#125;</span><br><span class="line">        strokwidth:[number] the draw line's width and height </span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawPoint</span><span class="params">(_ctx,point,strokwidth)</span></span>&#123;</span><br><span class="line">  strokwidth = strokwidth || <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(!(_ctx !== <span class="literal">undefined</span> &amp;&amp; _ctx !== <span class="literal">null</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">var</span> x = point.x,</span><br><span class="line">      y = point.y;</span><br><span class="line">  _ctx.fillRect(x,y,strokwidth,strokwidth);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、画形状</p>
<p>点的绘制讲述完毕，开始画曲线了，用 for 循环，画图吧。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">  func: </span><br><span class="line">        drawShape:draw a shape</span><br><span class="line">  args:</span><br><span class="line">        canvasId:[string]the canvas's id</span><br><span class="line">        func:[function]the shape function</span><br><span class="line">        ellipse:[object] the ellipse's a and b length such as &#123;"a":300,"b":200&#125;</span><br><span class="line">        center:[object] the draw center such as &#123;"x":400,"y":400&#125;</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawShape</span><span class="params">(canvasId,func,ellipse,center)</span></span>&#123;</span><br><span class="line">   <span class="keyword">var</span> _c = <span class="built_in">document</span>.getElementById(canvasId);</span><br><span class="line">  <span class="keyword">if</span>(_c === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">var</span> _ctx = _c.getContext(<span class="string">"2d"</span>);</span><br><span class="line"> <span class="comment">// 默认椭圆中心为canvas的中心</span></span><br><span class="line">  <span class="keyword">var</span> a = ellipse.a || <span class="number">0</span>,</span><br><span class="line">      b = ellipse.b || <span class="number">0</span>,</span><br><span class="line">      centerX = center.x || _c.width/<span class="number">2</span>,</span><br><span class="line">      centerY = center.y || _c.height/<span class="number">2</span>,</span><br><span class="line">      drawX,drawY,pointCX,pointCY;</span><br><span class="line">  shapeGet = func;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i &lt;= <span class="number">2</span>*<span class="built_in">Math</span>.PI; i+=<span class="number">0.0001</span>)&#123;<span class="comment">// 通过弧度绘图，精确到每个0.0001弧度画图，可以更加精确。但是小图的话，没必要那么精确，浪费CPU时间。</span></span><br><span class="line">    length = shapeGet(a,b,i);</span><br><span class="line">    pointCX = length*<span class="built_in">Math</span>.cos(i);</span><br><span class="line">    pointCY = length*<span class="built_in">Math</span>.sin(i);</span><br><span class="line">    drawX = centerX + pointCX;</span><br><span class="line">    drawY = centerY - pointCY;</span><br><span class="line">    drawPoint(_ctx,&#123;<span class="string">"x"</span>:drawX,<span class="string">"y"</span>:drawY&#125;,<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>调用方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drawShape(<span class="string">"myCanvas"</span>,ellipseFunc,&#123;<span class="string">"a"</span>:<span class="number">300</span>,<span class="string">"b"</span>:<span class="number">200</span>&#125;,&#123;<span class="string">"x"</span>:<span class="number">400</span>,<span class="string">"y"</span>:<span class="number">400</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>页面的全部源码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"cloud"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"myCanvas"</span> <span class="attribute">width</span>=<span class="value">"800"</span> <span class="attribute">height</span>=<span class="value">"800"</span>&gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line">  <span class="comment">/*</span><br><span class="line">    func: </span><br><span class="line">          ellipseFunc:return the length</span><br><span class="line">    args:</span><br><span class="line">          a:[number] ellipse's a</span><br><span class="line">          b:[number] ellipse's b</span><br><span class="line">          theta:[number] how much of Math.PI</span><br><span class="line">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ellipseFunc</span><span class="params">(a,b,theta)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// javascript Math对象下面的三角函数，传入的theta值必须是转换成弧度制的值，就是多少个3.141592…等等等的那个弧度制</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.pow(((a*a*b*b)*(<span class="number">1</span>+<span class="built_in">Math</span>.tan(theta)*<span class="built_in">Math</span>.tan(theta)))/(b*b+a*a*<span class="built_in">Math</span>.tan(theta)*<span class="built_in">Math</span>.tan(theta)),<span class="number">1</span>/<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span><br><span class="line">    func: </span><br><span class="line">          drawPoint:draw a point</span><br><span class="line">    args:</span><br><span class="line">          _ctx:[object]the canvas's getContent("2d") variable</span><br><span class="line">          point:[object] the point where to draw a dot such as &#123;"x":200,"y":200&#125;</span><br><span class="line">          strokwidth:[number] the draw line's width and height </span><br><span class="line">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">drawPoint</span><span class="params">(_ctx,point,strokwidth)</span></span>&#123;</span><br><span class="line">    strokwidth = strokwidth || <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(!(_ctx !== <span class="literal">undefined</span> &amp;&amp; _ctx !== <span class="literal">null</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> x = point.x,</span><br><span class="line">        y = point.y;</span><br><span class="line">    _ctx.fillRect(x,y,strokwidth,strokwidth);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span><br><span class="line">    func: </span><br><span class="line">          drawShape:draw a shape</span><br><span class="line">    args:</span><br><span class="line">          canvasId:[string]the canvas's id</span><br><span class="line">          func:[function]the shape function</span><br><span class="line">          ellipse:[object] the ellipse's a and b length such as &#123;"a":300,"b":200&#125;</span><br><span class="line">          center:[object] the draw center such as &#123;"x":400,"y":400&#125;</span><br><span class="line">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">drawShape</span><span class="params">(canvasId,func,ellipse,center)</span></span>&#123;</span><br><span class="line">     <span class="keyword">var</span> _c = <span class="built_in">document</span>.getElementById(canvasId);</span><br><span class="line">    <span class="keyword">if</span>(_c === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> _ctx = _c.getContext(<span class="string">"2d"</span>);</span><br><span class="line">   <span class="comment">// 默认椭圆中心为canvas的中心</span></span><br><span class="line">    <span class="keyword">var</span> a = ellipse.a || <span class="number">0</span>,</span><br><span class="line">        b = ellipse.b || <span class="number">0</span>,</span><br><span class="line">        centerX = center.x || _c.width/<span class="number">2</span>,</span><br><span class="line">        centerY = center.y || _c.height/<span class="number">2</span>,</span><br><span class="line">        drawX,drawY,pointCX,pointCY;</span><br><span class="line">    shapeGet = func;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i &lt;= <span class="number">2</span>*<span class="built_in">Math</span>.PI; i+=<span class="number">0.0001</span>)&#123;<span class="comment">// 通过弧度绘图，精确到每个0.0001弧度画图，可以更加精确，0.0001更加欢迎。但是小图的话，没必要那么精确，浪费CPU时间。</span></span><br><span class="line">      length = shapeGet(a,b,i);</span><br><span class="line">      pointCX = length*<span class="built_in">Math</span>.cos(i);</span><br><span class="line">      pointCY = length*<span class="built_in">Math</span>.sin(i);</span><br><span class="line">      drawX = centerX + pointCX;</span><br><span class="line">      drawY = centerY - pointCY;</span><br><span class="line">      drawPoint(_ctx,&#123;<span class="string">"x"</span>:drawX,<span class="string">"y"</span>:drawY&#125;,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  drawShape(<span class="string">"myCanvas"</span>,ellipseFunc,&#123;<span class="string">"a"</span>:<span class="number">300</span>,<span class="string">"b"</span>:<span class="number">200</span>&#125;,&#123;<span class="string">"x"</span>:<span class="number">400</span>,<span class="string">"y"</span>:<span class="number">400</span>&#125;);</span><br><span class="line"></span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>5、废话</p>
<p>本文产生的原因，本来是想做词云的，给定词云的形状，在这个形状内填充词语，产生了这个念头，词云还没实现，关键是如何才能让填充词语相互不覆盖的问题。后来，选择在 github 里面搜索算了，选择了一个 <a href="https://github.com/indyarmy/jQuery.awesomeCloud.pluginplugin" target="_blank" rel="external">jQuery.awesomeCloud.plugin</a>，但是填充效率确实压力山大。想过去模拟他的方法，做一个出来，因此先从画自定义曲线开始了。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>本篇文章，将讲述如何通过自定义的曲线函数，使用 canvas 的方式进行曲线的绘制。</p>
<p>为了通俗易懂，将以大家熟悉的椭圆曲线为例，进行椭圆的绘制。至于其他比较复杂的曲线，用户只需通过数学方式建立起曲线函数，然后变换成为距离函数方程，替换即可。另外：代码还没进行任何优化。<br>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[nodejs 平台的 webscoket 的实现]]></title>
    <link href="http://shenqihui.github.io/2013/08/07/nodejs-%E5%B9%B3%E5%8F%B0%E7%9A%84-webscoket-%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <id>http://shenqihui.github.io/2013/08/07/nodejs-平台的-webscoket-的实现/</id>
    <published>2013-08-06T20:43:00.000Z</published>
    <updated>2015-05-12T15:12:39.000Z</updated>
    <content type="html"><![CDATA[<p>新手入门，没办法，只能选择不断不断的 google 吧。</p>
<p>找了很多的例子都跑不了，不知道什么原因。</p>
<p>后，自己在 git 搜索吧，选择了一个下面的例子： <strong><a href="https://github.com/kashiif/nodejs-web-socket" target="_blank" rel="external">nodejs-web-socket</a></strong></p>
<p>经过我的改造，改成我自己想要的方式。<br><a id="more"></a><br>只是将客户端发送的数据直接原封不动发回客户端。</p>
<p>先说说运行环境：<code>window 7</code> ， <code>node v0.10.5</code>，全局安装了 <code>websocket.io</code> 模块，<code>chrome 28</code> 浏览器。</p>
<p>（注：以下提到的两个 js 文件放在同一层目录下面即可，html 文件随便放置）</p>
<p>这是后台的 js 代码：</p>
<p>1、将其存为 <code>socketServer.js</code> 文件里面，并且进行 <code>module</code> 导出。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">  仅用于测试，</span><br><span class="line">  客户端发送的东西将被服务器原封不动的返回到客户端</span><br><span class="line">  运行环境：node v0.10.5</span><br><span class="line">            window 7</span><br><span class="line">            chromw 28</span><br><span class="line">*/</span></span><br><span class="line"><span class="comment">/*var server = */</span><span class="built_in">module</span>.exports = ( <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ws = <span class="built_in">require</span>(<span class="string">'websocket.io'</span>);</span><br><span class="line">  <span class="keyword">var</span> socketServer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">var</span> socketInitListen = <span class="function"><span class="keyword">function</span><span class="params">(port)</span> </span>&#123;</span><br><span class="line">    socketServer = ws.listen(port);</span><br><span class="line">    socketServer.on(<span class="string">'listening'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Socket server running'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    socketServer.on(<span class="string">'connection'</span>,<span class="function"><span class="keyword">function</span><span class="params">(socket)</span> </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Connected to client'</span>);</span><br><span class="line">      socket.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// client send message to server</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Server received message : '</span>,data);</span><br><span class="line">        socket.send(data);</span><br><span class="line">      &#125;);</span><br><span class="line">      socket.on(<span class="string">'close'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        socket.send(<span class="string">'close'</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span><span class="params">(socketPort)</span> </span>&#123;</span><br><span class="line">    socketInitListen(socketPort);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    init: init</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// server.init(9000);</span></span><br></pre></td></tr></table></figure></p>
<p>2、引用上面那个module的文件，并且将端口绑定为9000端口，存为文件server.js。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> socketServer = <span class="built_in">require</span>(<span class="string">'./socketServer'</span>).init(<span class="number">9000</span>);</span><br></pre></td></tr></table></figure>
<p>3、页面的代码 ：index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>WebSockets Node.js<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="class">.container</span><span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">margin</span>:<span class="value">auto</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">300px</span></span></span>;</span><br><span class="line">        <span class="rule">&#125;</span></span></span><br><span class="line">        <span class="tag">label</span>,<span class="tag">input</span><span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">200px</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">float</span>:<span class="value">left</span></span>;</span><br><span class="line">        <span class="rule">&#125;</span></span></span><br><span class="line">        <span class="tag">input</span><span class="attr_selector">[type=button]</span><span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">float</span>:<span class="value">right</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">80px</span></span></span>;</span><br><span class="line">        <span class="rule">&#125;</span></span></span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://code.jquery.com/jquery.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"content"</span>&gt;</span>发送的内容:<span class="tag">&lt;/<span class="title">label</span>&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">id</span>=<span class="value">"content"</span> <span class="attribute">value</span>=<span class="value">"input something"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"recive"</span>&gt;</span>收到的内容:<span class="tag">&lt;/<span class="title">label</span>&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">id</span>=<span class="value">"recive"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">id</span>=<span class="value">"send"</span> <span class="attribute">value</span>=<span class="value">"点击发送"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line">      <span class="comment">// websocket 连接变量</span></span><br><span class="line">    <span class="keyword">var</span> wsConn;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        wsConn = <span class="keyword">new</span> WebSocket(<span class="string">'ws://127.0.0.1:9000'</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"websocket 连接出错。"</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)();</span><br><span class="line">    </span><br><span class="line">    $(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (wsConn) &#123;</span><br><span class="line">        wsConn.onopen = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"open Connection."</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        wsConn.onmessage = <span class="function"><span class="keyword">function</span><span class="params">(msg)</span> </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"onmessage."</span>);</span><br><span class="line">          <span class="built_in">console</span>.log(msg.data);</span><br><span class="line">          $(<span class="string">'#recive'</span>).val(msg.data);</span><br><span class="line">        &#125;;</span><br><span class="line">        wsConn.onerror = <span class="function"><span class="keyword">function</span><span class="params">(msg)</span> </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"onerror."</span>);</span><br><span class="line">          <span class="built_in">console</span>.log(msg);</span><br><span class="line">        &#125;;</span><br><span class="line">        wsConn.onclose = <span class="function"><span class="keyword">function</span><span class="params">(msg)</span> </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"onclose."</span>);</span><br><span class="line">          <span class="built_in">console</span>.log(msg);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">wsConnSend</span><span class="params">(content)</span> </span>&#123;</span><br><span class="line">            wsConn.send(content);</span><br><span class="line">        &#125;;</span><br><span class="line">        $(<span class="string">'#send'</span>).bind(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span> <span class="title">sendClick</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            wsConnSend($(<span class="string">'#content'</span>).val());</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这都是源码的三个文件。</p>
<p>运行的方法为：</p>
<p>1、安装<code>node</code> ，我的版本是 <code>0.10.5</code>，其他版本没进行测试；</p>
<p>2、安装 <code>websocket.io</code>，命令如下 <code>npm i -g websocket.io</code>；</p>
<p>3、环境弄好了，可以跑了，打开命令行，cd 到当前目录，跑 <code>node server.js</code>。</p>
<p>4、直接用 chrome 以本地文件方式直接打开 <code>index.html</code> ，里面操作简单。其他浏览器没进行测试。当然以 http 形式访问更好。</p>
<p>搭建完毕。</p>
<p>这是控制台下面的一行命令的截图。</p>
<p><img src="http://images.cnitblog.com/blog/358891/201308/07124246-07456af2379947258a81200c6353462e.png" alt=""></p>
<p>新手习作，若有出错，敬请大神指出。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>新手入门，没办法，只能选择不断不断的 google 吧。</p>
<p>找了很多的例子都跑不了，不知道什么原因。</p>
<p>后，自己在 git 搜索吧，选择了一个下面的例子： <strong><a href="https://github.com/kashiif/nodejs-web-socket">nodejs-web-socket</a></strong></p>
<p>经过我的改造，改成我自己想要的方式。<br>]]>
    
    </summary>
    
      <category term="javascript" scheme="http://shenqihui.github.io/tags/javascript/"/>
    
      <category term="nodejs" scheme="http://shenqihui.github.io/tags/nodejs/"/>
    
      <category term="websocket" scheme="http://shenqihui.github.io/tags/websocket/"/>
    
      <category term="技术" scheme="http://shenqihui.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[读过的某些书]]></title>
    <link href="http://shenqihui.github.io/2012/11/12/%E8%AF%BB%E8%BF%87%E7%9A%84%E6%9F%90%E4%BA%9B%E4%B9%A6/"/>
    <id>http://shenqihui.github.io/2012/11/12/读过的某些书/</id>
    <published>2012-11-11T20:18:00.000Z</published>
    <updated>2015-02-15T15:41:34.000Z</updated>
    <content type="html"><![CDATA[<p>只是以此记录下，不足以参考。<br><a id="more"></a><br>jquery实战：比较基础的感觉；</p>
<p>javascript语言精粹：周爱民有一本差不多的，弥漫着香味；</p>
<p>高性能javascript：巧妙，学的是思想；</p>
<p>javascript权威指南：你会感觉到，一个提升，醍醐灌顶的感觉；</p>
<p>javascript设计模式：设计模式的魅力，非功力深厚不要轻易尝试；</p>
<p>测试驱动的javascript开发：还没看完，看了前面的，不知道怎么描述，看书名就感觉，牛人必备；</p>
<p>css web设计高级教程：感觉就像一本很低调的书，包装精美，看上去非常的舒服；</p>
<p>html5揭秘：将它列为参考书，用的时候在看看；</p>
<p>javascript程序员参考手册：这本书，不是用来看的；</p>
<p>待续；</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>只是以此记录下，不足以参考。<br>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[深入理解判断IE浏览器的经典方法-James Padolsey判断法]]></title>
    <link href="http://shenqihui.github.io/2012/07/20/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%88%A4%E6%96%ADIE%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E7%BB%8F%E5%85%B8%E6%96%B9%E6%B3%95-James-Padolsey%E5%88%A4%E6%96%AD%E6%B3%95/"/>
    <id>http://shenqihui.github.io/2012/07/20/深入理解判断IE浏览器的经典方法-James-Padolsey判断法/</id>
    <published>2012-07-19T18:11:00.000Z</published>
    <updated>2015-05-12T15:13:28.000Z</updated>
    <content type="html"><![CDATA[<p>标题这样子，是为了吸引眼球，至于是不是 James Padolsey 原创的方法，网上是这么流传的就是了。菜鸟习作，写的不好，请轻拍。如果错误，请指出，感谢。<br><a id="more"></a><br>正题：</p>
<p>IE浏览器钉子户不断，IE 6像个老不死的一样存活在世界上，有人说：主要是因为 chinese 多。</p>
<p>我们现在开发网站都不针对 IE6，需要针对的话得增加项目经费，毕竟 IE6 及其以下的 css 变现比较坑爹。</p>
<p>因此，多了下面这个函数，提醒客户不要在IE6及其以下版本进行浏览网站。</p>
<p>请看</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line">      <span class="keyword">var</span> ie = (<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> undef,</span><br><span class="line">        v = <span class="number">3</span>,</span><br><span class="line">        div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>),</span><br><span class="line">        all = div.getElementsByTagName(<span class="string">'i'</span>);</span><br><span class="line">        <span class="keyword">while</span> (</span><br><span class="line">          div.innerHTML = <span class="string">'&lt;!—[if gt IE '</span> + (++v) + <span class="string">']&gt;&lt;i&gt;&lt;/i&gt;&lt;![endif]—&gt;'</span>,</span><br><span class="line">          all[<span class="number">0</span>]</span><br><span class="line">        ) ;</span><br><span class="line">        <span class="keyword">return</span> v &gt; <span class="number">4</span> ? v : undef</span><br><span class="line">      &#125;());</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">is_ie</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!ie)</span><br><span class="line">          alert(<span class="string">'您当前使用非Microsoft Internet Explorer.'</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ie&lt;=<span class="number">6</span>)</span><br><span class="line">          alert(<span class="string">'您当前使用的浏览器版本过低。为获取良好的用户体验，\n请选择 IE 7.0 及其以上版本的Microsoft Internet Explorer.'</span>);</span><br><span class="line">  　　&#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">body</span> <span class="attribute">onload</span>=<span class="value">"is_ie()"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这算是最简单又最高高效的IE判别方法了。不过，大部分人看不懂。</p>
<p>下面解析下为什么这样子：我的理解，如有错误，敬请指出，共同学习，多谢。</p>
<p>首先怎么调用，我就不讲了，如果不是 IE，直接将 ie 赋值为 undefined 的值，就是 undefined，现在直接讲讲这货的代码块里面这个吧。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (</span><br><span class="line">  div.innerHTML = <span class="string">'&lt;!—-[if gt IE '</span> + (++v) + <span class="string">']&gt;&lt;i&gt;&lt;/i&gt;&lt;![endif]-—&gt;'</span>,</span><br><span class="line">  all[<span class="number">0</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>这段代码。听巧妙的用到了逗号表达式，逗号表达式就是在表达式中，无论什么情况，返回最后一个子表达式的值，在这里就是返回 all[0] 的值了。</p>
<p>前面的 div 的赋值，为什么要放在这里，是因为这样子才能保证每次循环都能赋值，原创者这样写的话，是为了精简，这段代码，已经不能再精简了。</p>
<p>其实，能改成另外一种符合常人思维的形式。如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;  </span><br><span class="line">  div.innerHTML = <span class="string">'&lt;!--[if gt IE '</span> + (++v) + <span class="string">']&gt;&lt;i&gt;&lt;/i&gt;&lt;![endif]--&gt;'</span>;         </span><br><span class="line">&#125; <span class="keyword">while</span>(all[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>改成这样子，while 循环应该能看懂了吧？</p>
<p>其实不然，毕竟控制循环的变量很难理解对吧。</p>
<p>首先我们测试一下，就在这个 while 循环的下面，写上 alert(all[0])，</p>
<p>如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;  </span><br><span class="line">  div.innerHTML = <span class="string">'&lt;!--[if gt IE '</span> + (++v) + <span class="string">']&gt;&lt;i&gt;&lt;/i&gt;&lt;![endif]--&gt;'</span>;         </span><br><span class="line">&#125;<span class="keyword">while</span>(all[<span class="number">0</span>]) </span><br><span class="line">alert(all[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>你会发现，警告都是 undefined 。</p>
<p>但是，如果将这个写在 while 循环里面，你会发现，最后的那次警告必然是 undefined ，之前的都是 object （IEtester 下面），非IE浏览器的话，只有一个警告，为 undefined。代码如下，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;  </span><br><span class="line">  div.innerHTML = <span class="string">'&lt;!--[if gt IE '</span> + (++v) + <span class="string">']&gt;&lt;i&gt;&lt;/i&gt;&lt;![endif]--&gt;'</span>;</span><br><span class="line">  alert(all[<span class="number">0</span>])         </span><br><span class="line">&#125;<span class="keyword">while</span>(all[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>说道这里，大家应该知道用什么变量控制 while 循环的吧。</p>
<p>然后讲讲为什么 <code>all[0]</code> 会被赋值成为这样。下面根据 w3c 标准来讲讲看。</p>
<p>因为 <code>getElementsByTagName</code> 这个函数返回的是一个指向 <code>NodeList</code> 类型，请看<a href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#ID-A6C9094" title="getElementsByTagName" target="_blank" rel="external">getElementsByTagName</a></p>
<p>而当 <code>div</code> 进行了重新赋值之后，应为 <code>NodeList</code>  是活动的（目测这么翻译，摘自 <code>NodeListobjects in the DOM are [live](http://www.w3.org/TR/DOM-Level-3-Core/core.html#td-live)</code>. 摘自<a href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#ID-536297177" target="_blank" rel="external">Interface NodeList</a>），所以整个NodeList的对象集合也就发生改变。请看<a href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#td-live" target="_blank" rel="external">live</a>。</p>
<p>因此，all 每次指向的东西都是不变的，变的是 NodeList，all[0] 指向的是 NodeList 的第一个 i 元素，也因此发生改变。</p>
<p>然后讲讲，为什么通过这样子的判断能判断出 all[0] 到底是 object 还是 undefined 呢？</p>
<p>原因很简单，就是，非IE浏览器不认识这样的条件注释。IE浏览器也不认不能相对应的那些条件注释。</p>
<p>下面是部分条件注释写法。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--[if IE]&gt;&lt;i&gt;您使用的是IE浏览器。&lt;/i&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 6]&gt;&lt;i&gt;欢迎使用Internet Explorer 6&lt;/i&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if !(IE 6)]&gt;&lt;i&gt;您正在使用的不是 IE6。&lt;/i&gt;&lt;![endif]--&gt;</span></span><br></pre></td></tr></table></figure>
<p>太多，我就不写出来，详细规则请看<a href="http://msdn.microsoft.com/en-us/library/ms537512(VS.85" target="_blank" rel="external">微软官方</a>.aspx)。</p>
<p>到了这里，大家应该大概了解了吧。</p>
<p>估计现在大家看我这篇文章的时候，用的都不是IE，那就举一个是IE的例子。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--[if IE]&gt;&lt;i&gt;您使用的不是IE浏览器。&lt;/i&gt;&lt;![endif]--&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果是IE浏览器，那么这段东西里面的 <code>&lt;i&gt;&lt;/i&gt;</code> 标签就能被 IE 浏览器当正常的 DOM 元素。</p>
<p>如果不是IE浏览器，那么 <code>[if IE]&gt;&lt;i&gt;您使用的不是IE浏览器。&lt;/i&gt;&lt;![endif]</code> 整一句都会被当场注释掉了。至于 <code>[if !IE]</code>，目前来说，还是不能被非IE正确判别。</p>
<p>讲到这里，大家还不懂的话，那么我这篇文章写得不好。抱歉浪费您的时间来看了。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>标题这样子，是为了吸引眼球，至于是不是 James Padolsey 原创的方法，网上是这么流传的就是了。菜鸟习作，写的不好，请轻拍。如果错误，请指出，感谢。<br>]]>
    
    </summary>
    
      <category term="javascript" scheme="http://shenqihui.github.io/tags/javascript/"/>
    
      <category term="前端" scheme="http://shenqihui.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="技术" scheme="http://shenqihui.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
</feed>