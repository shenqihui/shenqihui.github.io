<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="utf-8">
  
  <title>探讨css中repaint和reflow | 神奇辉的Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="(个人blog迁移文章。)
前言：
页面设计中，不可避免的需要浏览器进行repaint和reflow。那到底什么是repaint和reflow呢。下面谈谈自己对repaint和reflow的理解，以及结合其他技术牛的讲解，谈谈如何优化repaint和reflow。">
<meta property="og:type" content="article">
<meta property="og:title" content="探讨css中repaint和reflow">
<meta property="og:url" content="http://shenqihui.github.io/2014/02/12/探讨css中repaint和reflow/index.html">
<meta property="og:site_name" content="神奇辉的Blog">
<meta property="og:description" content="(个人blog迁移文章。)
前言：
页面设计中，不可避免的需要浏览器进行repaint和reflow。那到底什么是repaint和reflow呢。下面谈谈自己对repaint和reflow的理解，以及结合其他技术牛的讲解，谈谈如何优化repaint和reflow。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="探讨css中repaint和reflow">
<meta name="twitter:description" content="(个人blog迁移文章。)
前言：
页面设计中，不可避免的需要浏览器进行repaint和reflow。那到底什么是repaint和reflow呢。下面谈谈自己对repaint和reflow的理解，以及结合其他技术牛的讲解，谈谈如何优化repaint和reflow。">
<meta name="twitter:creator" content="@shenqihui">
  
    <link rel="alternative" href="/atom.xml" title="神奇辉的Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header class="header">
  <div class="header-outer outer">
    <div class="profile_img">
      <img class="circle_img" src="/img/profile_img.jpg" />
    </div>
    <div class="header-title">
      <h1 class="logo">神奇辉的Blog</h1>
      
        <h4 class="subtitle">吾十有五而志于养猪，三十始养，四十亏本，五十再亏，六十亏大了，七十卒，不逾矩。现廿五，将卒。</h4>
      
    </div>
    <div class="header-menu">
      <nav class="main-nav">
        <ul>
        
          <li><a href="/"><i class="fa fa-home icon-setting"></i></a></li>
        
          <li><a href="http://www.weibo.com/p/1005051896403155"><i class="fa fa-weibo icon-setting"></i></a></li>
        
          <li><a href="https://github.com/shenqihui"><i class="fa fa-github icon-setting"></i></a></li>
        
        
          <li><a href="/atom.xml"><i class="fa fa-rss %> icon-setting"></i></a></li>
        
        </ul>
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-探讨css中repaint和reflow" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/02/12/探讨css中repaint和reflow/" class="article-date">
  <time datetime="2014-02-11T21:47:00.000Z" itemprop="datePublished">2014 年 02 月 12 日</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      探讨css中repaint和reflow
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>(个人blog迁移文章。)</p>
<p><strong>前言：</strong></p>
<p>页面设计中，不可避免的需要浏览器进行repaint和reflow。那到底什么是repaint和reflow呢。下面谈谈自己对repaint和reflow的理解，以及结合其他技术牛的讲解，谈谈如何优化repaint和reflow。<br><a id="more"></a><br><strong>初步介绍：</strong></p>
<p>开发一个页面时，不可避免的需要进行repaint和reflow。也就只有古来的静态页面才会不存在repaint和reflow。repaint主要是针对某一个DOM元素进行的重绘，reflow则是回流，针对整个页面的重排。字面意思来说：repaint就是重绘，reflow就是回流。repaint和reflow的目的是：展示一个新的页面样貌。</p>
<p><strong>严重性：</strong></p>
<p>在性能优先的前提下，性能消耗 reflow大于repaint。</p>
<p><strong>体现：</strong></p>
<p>repaint是某个DOM元素进行重绘；reflow是整个页面进行重排，也就是页面所有DOM元素渲染。</p>
<p><strong>如何触发：</strong></p>
<p>style变动造成repaint和reflow。</p>
<p>不涉及任何DOM元素的排版问题的变动为repaint，例如元素的color/text-align/text-decoration等等属性的变动。</p>
<p>除上面所提到的DOM元素style的修改基本为reflow。例如元素的任何涉及长、宽、行高、边框、display等style的修改。</p>
<p><strong>常见触发场景：</strong></p>
<ol>
<li><p>触发repaint：</p>
<pre><code><span class="number">1</span>.  <span class="attribute">color</span>的修改，如<span class="attribute">color</span>=<span class="hexcolor">#ddd</span>；
</code></pre><ol>
<li>text-align的修改，如text-align=center；</li>
<li>a:hover也会造成重绘。</li>
<li>:hover引起的颜色等不导致页面回流的style变动。</li>
<li>等等太多，一时间写出来也太难想了。</li>
</ol>
</li>
<li><p>触发reflow：</p>
<pre><code><span class="number">1</span>.  <span class="attribute">width</span>/<span class="attribute">height</span>/<span class="attribute">border</span>/<span class="attribute">margin</span>/<span class="attribute">padding</span>的修改，如<span class="attribute">width</span>=<span class="number">778px</span>；
</code></pre><ol>
<li>动画，:hover等伪类引起的元素表现改动，display=none等造成页面回流；</li>
<li>appendChild等DOM元素操作；</li>
<li>font类style的修改；</li>
<li>background的修改，注意着字面上可能以为是重绘，但是浏览器确实回流了，经过浏览器厂家的优化，部分background的修改只触发repaint，当然IE不用考虑；</li>
<li>scroll页面，这个不可避免；</li>
<li>resize页面，桌面版本的进行浏览器大小的缩放，移动端的话，还没玩过能拖动程序，resize程序窗口大小的多窗口操作系统。</li>
<li>读取元素的属性（这个无法理解，但是技术达人是这么说的，那就把它当做定理吧）：读取元素的某些属性（offsetLeft、offsetTop、offsetHeight、offsetWidth、scrollTop/Left/Width/Height、clientTop/Left/Width/Height、getComputedStyle()、currentStyle(in IE))；</li>
</ol>
</li>
</ol>
<p><strong>如何避免：</strong></p>
<p>说避免那是不可能的，不然就是以前古老的静态页面了，没有交互，那在现在看来，就是一个失败的作品。所以，在我们进行网页设计的时候，就必须尽量减少页面的repaint和reflow。repaint和reflow的目的是为了展示一个新的页面，那么我们在进行页面交互时，尽量通过各种方法减少repaint和reflow但又能展示一个新的页面的目的。所以下面将结合其他技术达人的建议，通过自己的理解，给大家讲解如何避免和优化repaint和reflow：</p>
<p>下面是大神Nicole Sullivan的原话：</p>
<blockquote>
<ol>
<li>Change classes on the element you wish to style (as low in the dom tree as possible)</li>
<li>Avoid setting multiple inline styles</li>
<li>Apply animations to elements that are position fixed or absolute</li>
<li>Trade smoothness for speed</li>
<li>Avoid tables for layout</li>
<li>Avoid JavaScript expressions in the CSS&nbsp;(IE only)</li>
</ol>
</blockquote>
<ol>
<li><strong>尽可能在DOM末梢通过改变class来修改元素的style属性</strong>：尽可能的减少受影响的DOM元素。</li>
<li><strong>避免设置多项内联样式</strong>：使用常用的class的方式进行设置样式，以避免设置样式时访问DOM的低效率。</li>
<li><strong>设置动画元素position属性为fixed或者absolute</strong>：由于当前元素从DOM流中独立出来，因此受影响的只有当前元素，元素repaint。</li>
<li><strong>牺牲平滑度满足性能</strong>：动画精度太强，会造成更多次的repaint/reflow，牺牲精度，能满足性能的损耗，获取性能和平滑度的平衡。</li>
<li><strong>避免使用table进行布局</strong>：table的每个元素的大小以及内容的改动，都会导致整个table进行重新计算，造成大幅度的repaint或者reflow。改用div则可以进行针对性的repaint和避免不必要的reflow。</li>
<li><strong>避免在CSS中使用运算式</strong>：学习CSS的时候就知道，这个应该避免，不应该加深到这一层再去了解，因为这个的后果确实非常严重，一旦存在动画性的repaint/reflow，那么每一帧动画都会进行计算，性能消耗不容小觑。</li>
</ol>
<p><strong>参考文献：</strong></p>
<ol>
<li><a href="http://www.blueidea.com/tech/web/2011/8365.asp" title="http://www.blueidea.com/tech/web/2011/8365.asp" target="_blank" rel="external">页面重构应注意的repaint和reflow</a></li>
<li><a href="http://blog.csdn.net/baiduforum/article/details/5415527" title="如何减少浏览器repaint和reflow（上）" target="_blank" rel="external">如何减少浏览器repaint和reflow（上）</a></li>
<li><a href="http://www.zhangxinxu.com/wordpress/2010/01/%E5%9B%9E%E6%B5%81%E4%B8%8E%E9%87%8D%E7%BB%98%EF%BC%9Acss%E6%80%A7%E8%83%BD%E8%AE%A9javascript%E5%8F%98%E6%85%A2%EF%BC%9F/" title="回流与重绘：CSS性能让JavaScript变慢？" target="_blank" rel="external">回流与重绘：CSS性能让JavaScript变慢？</a></li>
<li><a href="http://www.stubbornella.org/content/2009/03/27/reflows-repaints-css-performance-making-your-javascript-slow/" title="Permanent Link: Reflows &amp; Repaints: CSS Performance making your JavaScript slow?" target="_blank" rel="external">Reflows &amp; Repaints: CSS Performance making your JavaScript slow?</a></li>
</ol>
<p>&nbsp;</p>
<p>觉得有用，点个赞，赞赞更健康。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://shenqihui.github.io/2014/02/12/探讨css中repaint和reflow/" data-id="ci75qnxht000ao9aznh8vrjnm" class="article-share-link">Share</a>
      
        <a href="http://shenqihui.github.io/2014/02/12/探讨css中repaint和reflow/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/02/12/探讨javascript面向对象编程/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          探讨javascript面向对象编程
        
      </div>
    </a>
  
  
    <a href="/2014/02/08/汤姆大叔设计模式学习体会：设计模式的思想/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">汤姆大叔设计模式学习体会：设计模式的思想</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 神奇辉<br>
      Theme remake by <a href="https://github.com/shenqihui/hexo-theme-alberta" target="_blank">shenqihui</a> base <a href="http://jaychung.tw" target="_blank">jaychung</a>'s <a href="https://github.com/ken8203/hexo-theme-alberta" target="_blank">Alberta</a>. Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://pages.github.com/">Github Pages</a>. <a href="/sitemap.xml">Sitemap</a> .
    </div>
  </div>
</footer>

    </div>
    
    
<script>
  var disqus_shortname = 'shenqihuiblog';
  
  var disqus_url = 'http://shenqihui.github.io/2014/02/12/探讨css中repaint和reflow/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//cdn.bootcss.com/jquery/2.1.3/jquery.min.js
"></script>
<!--<script src="//imsky.github.io/holder/holder.js"></script>-->

  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-48454013-1', 'auto');
ga('require', 'displayfeatures');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<!-- Baidu Analytics -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a359010dd82707c1ee6d1ca5d64be33b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- Baidu Google Analytics -->

</body>
</html>