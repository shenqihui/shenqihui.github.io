<!DOCTYPE html><html lang="zh-cmn-Hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>js页码生成库，一个适合前后端分离的页码生成器 | 大饼</title><meta name="author" content="大饼"><meta name="description" content="博客,blog,前端,hexo,nodejs,javascript,python,html,css,npm"><link rel="alternate" href="/atom.xml" title="大饼" type="application/rss2.xml"><meta name="description" content="前言上星期写的任务里面有需要进行分页的处理，git搜索了一番，没有觉得合适的，于是自己临时写了个分页的算法。然后等闲下来的时候，决定把分页进行优化并推广。于是乎，一个适合前后端分离的页码生成器就这样出来了。"><meta name="keywords" content="javascript,技术,前端"><meta property="og:type" content="article"><meta property="og:title" content="js页码生成库，一个适合前后端分离的页码生成器"><meta property="og:url" content="http://blog.shenqh.com/2014/07/13/js页码生成库，一个适合前后端分离的页码生成器/index.html"><meta property="og:site_name" content="大饼"><meta property="og:description" content="前言上星期写的任务里面有需要进行分页的处理，git搜索了一番，没有觉得合适的，于是自己临时写了个分页的算法。然后等闲下来的时候，决定把分页进行优化并推广。于是乎，一个适合前后端分离的页码生成器就这样出来了。"><meta property="og:locale" content="zh-cmn-Hans"><meta property="og:updated_time" content="2016-12-02T16:08:39.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="js页码生成库，一个适合前后端分离的页码生成器"><meta name="twitter:description" content="前言上星期写的任务里面有需要进行分页的处理，git搜索了一番，没有觉得合适的，于是自己临时写了个分页的算法。然后等闲下来的时候，决定把分页进行优化并推广。于是乎，一个适合前后端分离的页码生成器就这样出来了。"><meta name="twitter:creator" content="@shenqihui"><link rel="alternative" href="/atom.xml" title="大饼" type="application/atom+xml"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/app.css"><style type="text/css">body,h1,h2,h3,h4,h5,h6{font-family:Raleway,sans-serif}</style><style type="text/css">code,kbd,pre,samp,tt,var{font-family:Monaco,Consolas,monospace}</style></head></html><body class="site-page"><nav class="site-navbar"><ul nav-left><h1>大饼</h1></ul><ul nav-right><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/link">Link</a></li><li><a href="http://www.weibo.com/p/1005051896403155" target="_blank">Weibo</a></li><li><a href="https://github.com/shenqihui" target="_blank">Github</a></li><li><a href="/about">About</a></li></ul></nav><section site-body part-post><section post><article id="post-js页码生成库，一个适合前后端分离的页码生成器" layout="post"><h1 post-title>js页码生成库，一个适合前后端分离的页码生成器</h1><time post-time datetime="2014-07-13T01:50:00.000Z" itemprop="datePublished">2014 年 07 月 13 日</time><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术/">技术</a></li></ul><div class="clearfix"></div><div page-excerpt><p><strong>前言</strong></p><p>上星期写的任务里面有需要进行分页的处理，git搜索了一番，没有觉得合适的，于是自己临时写了个分页的算法。</p><p>然后等闲下来的时候，决定把分页进行优化并推广。于是乎，一个适合前后端分离的页码生成器就这样出来了。<br></p></div><div page-more><br>先别废话了，直接上 <a href="https://github.com/shenqihui/pagination" target="_blank" rel="noopener">git 地址</a> 和 <a href="http://shenqihui.github.io/pagination/" target="_blank" rel="noopener">demo 地址</a>。看官果断点击进去瞧瞧看。项目主页的 readme 文档的自动排版将更好。<p></p><p><strong>先讲讲设计思想</strong></p><p>整个开发流程围绕事件绑定进行开发。</p><p>脱离 callback 回调这种回调方法，直接使用 事件 方式触发换页前后的动作，方便解耦。</p><p>既然使用这种方式进行回调，就使用全局变量挂载分页的数据，方便回调时候进行分页数据的访问。</p><p><strong>库的依赖</strong></p><p>由于开发库的时候，并没有使用原生的语法进行元素或者事件绑定的操作，因此需要依赖某个库。</p><p>现阶段，经过测试支持 zepto 以及 jquery （二选一）。</p><p>css 方面，建议还是直接自己写或者使用 bootstrap 的库，源代码里面有从 bootstrap 里面抽出来的分页 css 代码。</p><p><strong>简洁demo</strong></p><p>由于分页就必须知道分页数据大小，因此必须传输配置对象。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pageConfig = &#123;</span><br><span class="line">  <span class="comment">// 每页显示的数据长度，必填，而且 &gt;1</span></span><br><span class="line">  prePageLenght: <span class="number">10</span>,</span><br><span class="line">  <span class="comment">// 数据的总长度，必填，而且 &gt;1</span></span><br><span class="line">  dataLength: <span class="number">30</span>,</span><br><span class="line">  <span class="comment">// 现在的页码，默认 1</span></span><br><span class="line">  pageNow: <span class="number">1</span>,</span><br><span class="line">  <span class="comment">// 渲染分页 html 的容器，一般框架的容器即可</span></span><br><span class="line">  renderBox: $(<span class="string">'.pagination-box'</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>配置之后，进行调用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 运行即可分页</span></span><br><span class="line">pageBuilder(pageConfig);</span><br></pre></td></tr></table></figure><p>这样子就能进行分页了。</p><p><strong>回调的书写</strong></p><p>回调的书写虽然放在了调用分页的主函数后面，但是记得在调用分页之前就定义这些事件，因为一旦调用分页函数，就马上触发分页回调，写在后面了，就会忘记了刚分页时候的事件回调了。</p><p>首先是分页前的回调，分页之前会触发 window 下面一个自定义分页之前的事件&nbsp;<span class="s1">beforePageChange ，因此要触发处理分页前的动作，就这样处理：</span></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提前定义好分页之前的动作，可选</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'beforePageChange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// callback</span></span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">  <span class="comment">// 获取当前页码，可以从 pageBuilder.page.pageNow 取得，注意此时的值为未分页之前的旧页码。</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>同样道理，分页之后的回调差不多：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提前定义好分页之后的动作，可选</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'afterPageChange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// callback</span></span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">  <span class="comment">// 获取当前页码，可以从 pageBuilder.page.pageNow 取得</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>特别说明</strong></p><p>一个页面只适合使用一个分页实例。分页的动作将在 hashchange 触发之后进行分页。</p><p>里面监控页码变化的函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绑定换页的事件</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'hashchange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hash = location.hash;</span><br><span class="line">  <span class="keyword">var</span> pageTemp = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/^#page=\d+$/</span>.test(hash) === <span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="comment">// 直接是页码的</span></span><br><span class="line">    pageTemp = hash.substring(<span class="number">6</span>) | <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (defaultConfig.pageNow !== pageTemp) &#123;</span><br><span class="line">      defaultConfig.pageNow = pageTemp;</span><br><span class="line">      $(<span class="built_in">window</span>).trigger(<span class="string">"renderPagination"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hash === <span class="string">"#page=next"</span>) &#123;</span><br><span class="line">    <span class="comment">// 下一页的</span></span><br><span class="line">    location.hash = <span class="string">"page="</span> + ( defaultConfig.pageNow + <span class="number">1</span> );</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hash === <span class="string">"#page=prev"</span>) &#123;</span><br><span class="line">    <span class="comment">// 上一页的</span></span><br><span class="line">    location.hash = <span class="string">"page="</span> + ( defaultConfig.pageNow - <span class="number">1</span> );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>因为 hashchange 只支持 IE8+，</p><p>所以，该插件只适合 IE8+，甚至IE8的怪异模式不支持 hashchange 事件。</p><p><strong>结束语</strong></p><p>这个库还有很多可以优化的地方，例如页码缓存，还有作用域优化之类的，还没进行优化。</p><p>希望大家喜欢。喜欢的话，点个推荐吧，如果使用上了，记得 star 下哦。</p></div><nav class="pagination"><a post-prev href="/2014/10/30/支付宝么么哒/" title="支付宝么么哒">&#10094; 支付宝么么哒</a> <a post-next href="/2014/02/28/任何一个团队，永远不会像你想象中的那么好，也不会如你所听说的那么糟。/" title="任何一个团队，永远不会像你想象中的那么好，也不会如你所听说的那么糟。">任何一个团队，永远不会像你想象中的那么好，也不会如你所听说的那么糟。 &#10095;</a></nav></article><section id="comments"><div id="disqus_thread"></div></section></section></section><section site-body class="dn"><nav><a href="/tags/css/" style="font-size:12px;color:#636363">css</a> <a href="/tags/ellipsis/" style="font-size:10px;color:#777">ellipsis</a> <a href="/tags/git/" style="font-size:10px;color:#777">git</a> <a href="/tags/javascript/" style="font-size:16px;color:#3a3a3a">javascript</a> <a href="/tags/life/" style="font-size:10px;color:#777">life</a> <a href="/tags/ppt/" style="font-size:10px;color:#777">ppt</a> <a href="/tags/python/" style="font-size:10px;color:#777">python</a> <a href="/tags/table/" style="font-size:10px;color:#777">table</a> <a href="/tags/warp/" style="font-size:10px;color:#777">warp</a> <a href="/tags/前端/" style="font-size:18px;color:#252525">前端</a> <a href="/tags/技术/" style="font-size:20px;color:#111">技术</a> <a href="/tags/旅游/" style="font-size:14px;color:#4e4e4e">旅游</a> <a href="/tags/生活/" style="font-size:10px;color:#777">生活</a> <a href="/tags/设计/" style="font-size:10px;color:#777">设计</a></nav></section><footer site-footer><div copyright>&copy; 2018 大饼<h4>吾十有五而志于养猪，三十始养，四十亏本，五十再亏，六十亏大了，七十卒，不逾矩。现廿五，将卒。</h4></div><div powered><b>Hexo <a href="https://github.com/shenqihui/hexo-theme-pithy" target="_blank">Pithy</a></b> Theme designed by <b><a href="http://blog.shenqh.com/" target="_blank">shenqihui</a></b>, Powered by <b><a href="http://hexo.io/" target="_blank">Hexo</a></b> and <b><a href="https://pages.github.com/">Github Pages</a></b>. <b><a href="/sitemap.xml">Sitemap</a></b>. <b><a href="/atom.xml">Rss</a></b>.</div><br><div footer_word>我们俩都是年轻人，要将自己献身于伟大事业的开创，我们是天生的魔术师，但我们不会用自己的天赋去伤害任何人。 -- 阿尔弗雷德·波登 《致命魔术》</div></footer><script>setTimeout(function(){var e="shenqihuiblog";!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()},100)</script><script type="text/javascript">!function(e,a,t,n,c,s,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,s=a.createElement(t),o=a.getElementsByTagName(t)[0],s.async=1,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-48454013-1","auto"),ga("require","displayfeatures"),ga("send","pageview")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?a359010dd82707c1ee6d1ca5d64be33b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body>