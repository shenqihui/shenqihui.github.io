var socketIOURL="//"+location.host+"/socket.io/socket.io.js";Slide.Control.add("socket",function(n,t){n.clientUID=0;var e,o,i=function(){document.addEventListener("keydown",function(n){81===n.keyCode&&e(n)},!0);var n=document.createElement("div");n.className="qrcode",n.id="qrcodeBox",n.innerHTML='<div id="qrcode"></div><p><a id="ctrlLink" href="#" target="_blank">打开控制端</a></p>';var t=document.getElementsByTagName("body")[0];t.appendChild(n);document.getElementById("container");(e=function(t){e.isShow?(n.style.display="none",e.isShow=!1):(n.style.display="block",e.isShow=!0)})()},c={host:"",role:"",send_default:function(n,t){o.emit("transfer.data",{action:"controlEvent:"+n,data:t})},send_keyEvent:function(n){c.send_default("keyEvent",{keyCode:n})},clientConnect:function(){},evtHandler:function(){o.on("transfer.data",function(n){t.fire(n.action,n.data)})},controlConnect:function(){o.emit("control.addClient",{targetUid:this.clientUID}),Slide.proxyFn=function(n,t){t=JSON.stringify(t),c.send_default("proxyFn",{fnName:n,args:t})}},connect:function(){o=io.connect(location.host+"/ppt"),o.on("UUID",function(n){o.uid=n,"client"===c.role&&MixJS.loadJS("/js/qrcode.js",function(){i();var t=location.href.split("#")[0];t+=~t.indexOf("?")?"&":"?",t+="iscontroller=1&clientid="+encodeURIComponent(n);new QRCode("qrcode",{text:t,width:256,height:256});document.getElementById("ctrlLink").href=t})}),o.on("system",function(t){switch(t.action){case"join":e&&e.isShow&&e(),c.send_default("syncStatus",{id:n.current,item:n.curItem});break;case"leave":e&&(e.isShow=!1,e())}}),this[this.role+"Connect"](),this.evtHandler()},init:function(n){this.host=n.host||location.href,this.clientUID=n.clientId,n.isControl?(this.role="control",Slide.timerCtrl()):this.role="client",n.shake&&MixJS.loadJS(Slide.dir+"shake.js",function(){var n=Date.now();window.addEventListener("shake",function(){var t=Date.now();t-n>3e3&&(n=t,c.send_keyEvent(39))},!0)}),window.io&&io.connect?c.connect():MixJS.loadJS(socketIOURL,function(){c.connect()})}};return c});