<!DOCTYPE html><html lang="zh-cmn-Hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>在自己家搭建一个 VPS | 大饼</title><meta name="author" content="大饼"><meta name="description" content="博客,blog,前端,hexo,nodejs,javascript,python,html,css,npm"><link rel="alternate" href="/atom.xml" title="大饼" type="application/rss2.xml"><meta name="description" content="这个只有在朋友圈环游世界的国庆，闲来无聊，弄了几个技术。其中一个，就是自己在家的 vps 。具体为啥？"><meta property="og:type" content="article"><meta property="og:title" content="在自己家搭建一个 VPS"><meta property="og:url" content="http://blog.shenqh.com/2016/10/05/create_a_vps_at_home/index.html"><meta property="og:site_name" content="大饼"><meta property="og:description" content="这个只有在朋友圈环游世界的国庆，闲来无聊，弄了几个技术。其中一个，就是自己在家的 vps 。具体为啥？"><meta property="og:image" content="http://blog.shenqh.com/picture/home_vps/luyouqi_ip.jpeg"><meta property="og:image" content="http://ddns.pboehm.org/update/demoddns/bf98352df343a71130fc3d8b298aa1a70f477a5a"><meta property="og:image" content="http://blog.shenqh.com/picture/home_vps/luyouqi_port.jpeg"><meta property="og:updated_time" content="2016-12-02T16:08:39.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="在自己家搭建一个 VPS"><meta name="twitter:description" content="这个只有在朋友圈环游世界的国庆，闲来无聊，弄了几个技术。其中一个，就是自己在家的 vps 。具体为啥？"><meta name="twitter:image" content="http://blog.shenqh.com/picture/home_vps/luyouqi_ip.jpeg"><meta name="twitter:creator" content="@shenqihui"><link rel="alternative" href="/atom.xml" title="大饼" type="application/atom+xml"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/app.css"></head></html><body class="site-page"><nav class="site-navbar"><ul nav-left><h1>大饼</h1></ul><ul nav-right><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/link">Link</a></li><li><a href="http://www.weibo.com/p/1005051896403155" target="_blank">Weibo</a></li><li><a href="https://github.com/shenqihui" target="_blank">Github</a></li><li><a href="/about">About</a></li></ul></nav><section site-body part-post><section post><article id="post-create_a_vps_at_home" layout="post"><h1 post-title>在自己家搭建一个 VPS</h1><time post-time datetime="2016-10-05T12:38:23.000Z" itemprop="datePublished">2016 年 10 月 05 日</time><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术/">技术</a></li></ul><div class="clearfix"></div><div page-excerpt><p>这个只有在朋友圈环游世界的国庆，闲来无聊，弄了几个技术。其中一个，就是自己在家的 vps 。</p><p>具体为啥？</p></div><div page-more><p>因为我想免流，然后，国外的那个 vps 太慢，又没钱买一个国内的。自己弄一个，方便自己使用，多好啊。<br>家里的 vps 能干啥，不知道，反正用的是 pcduino 弄得，性能过得去，随便外网使用咯。以后想干啥，就干啥了。</p><hr><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><ul><li>一条有外网 IP 的网线</li><li>路由器，条件：能绑定虚拟服务器，固定内网设备的 ip，例如我这个的 tplink TD-W89841N增强型。</li><li>一块内网设备，linux 的为妙，我用的是尘封已久的 pcduino （以前公司奖励的），下面的文章中提到的 pcduino 都是这个linux 设备咯。</li></ul><hr><p>下面开始操作啦。</p><hr><h1 id="第一步，链接设备"><a href="#第一步，链接设备" class="headerlink" title="第一步，链接设备"></a>第一步，链接设备</h1><p>链接网络，链接 pcduino 设备，上电，链接。</p><p>然后为 pcduino 设定固定的 ip ，避免每次重启之后的 ip 都变动了。</p><p>如图。<br><img src="/picture/home_vps/luyouqi_ip.jpeg" alt=""><br>其中那个 ip 为 192.168.1.3 的那个就是 pcduino 机器。固定为了 192.168.1.3 ，记着这个 ip ，下面会用到。<br>固定的步骤粗略说下把：</p><ul><li>pcduino 用网线连接，稳定</li><li>路由器设置，静态地址设置添加新条目把 pcduino 对应的 mac 地址写进去，写个定的地址，就 192.168.1.3</li><li>重启 pcduino ，启动完毕之后，就是上面提到的固定了的 ip 了。</li></ul><hr><h1 id="第二步，ddns"><a href="#第二步，ddns" class="headerlink" title="第二步，ddns"></a>第二步，ddns</h1><p>其实就是怎么知道外网的ip咯。</p><p>现在的宽带，重启路由，就给你换个 ip ，你怎么知道下次重启路由之后的 ip 是啥。</p><p>所以用到了 ddns 大法。 外边有提供服务的， 就 <a href="http://ddns.pboehm.org/">http://ddns.pboehm.org/</a></p><p>我弄个特定的，假设弄一个 demoddns.d.pboehm.de</p><p>网站给的代码是</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="string">"http://ddns.pboehm.org/update/demoddns/bf98352df343a71130fc3d8b298aa1a70f477a5a"</span></div></pre></td></tr></table></figure><p>所以只需要跑一下这个指令，就能设置 ddns 了。<br><br><img src="http://ddns.pboehm.org/update/demoddns/bf98352df343a71130fc3d8b298aa1a70f477a5a" style="width:1px;height:1px;border:0;position:absolute;left:-9999px;top:-99999px"></p><p>然后，你知道了 demoddns.d.pboehm.de 的对应解析记录，就肯定知道了自己的宽度此时的 ip 啦。</p><p>跑下 dig 看看咯。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dig @dns.pboehm.de demoddns.d.pboehm.de</div></pre></td></tr></table></figure><p></p><p>这个时候，我都都不知道绑定到谁的 ip 了，因为我在文章里面设定了个动作，自动把 ddns 更新到最新查看的人的 ip ，所以你过一会 dig 一下，估计就解析到你的 ip 了。</p><p>ps: 解析可能有点延迟，就酱。但是这个 server 是解析最快了的，因为是他家的。</p><hr><h1 id="第三步，让-pcduino-自动更新-ddns"><a href="#第三步，让-pcduino-自动更新-ddns" class="headerlink" title="第三步，让 pcduino 自动更新 ddns"></a>第三步，让 pcduino 自动更新 ddns</h1><p>就是弄个定时任务咯，我定时了每一分钟跑一次。</p><p>把上线的网站给的 curl 指令存到 /home/linaro/crontab/ddns.sh 中，并增加全部人 x 权限。</p><p>看我的 crontab，加进自己的 crontab 。（如果开机 crontab 没自动启动，记得启动下， /etc/init.d/anacron 这个能帮你。）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">*  *    * * *   linaro  /bin/sh /home/linaro/crontab/ddns.sh</div></pre></td></tr></table></figure><p>就这样，每一分钟都泡一下那个 ddns.sh 的指令</p><hr><h1 id="第四步，内网转发咯。"><a href="#第四步，内网转发咯。" class="headerlink" title="第四步，内网转发咯。"></a>第四步，内网转发咯。</h1><p>看图</p><p><img src="/picture/home_vps/luyouqi_port.jpeg" alt=""></p><p>我把部分开启的端口，通过这样子绑定虚拟服务器方式，暴露到了公网。最重要的是，把 ssh 链接端口暴露，这样才能链接进来。</p><p>注意，外网上面的人都很邪恶，记得把 ssh 登录的密码设定很复杂，或者不让 ssh 密码登录。</p><hr><h1 id="第五步，内网漫游"><a href="#第五步，内网漫游" class="headerlink" title="第五步，内网漫游"></a>第五步，内网漫游</h1><p>有了一个 vps ，你说能干啥，要是能远程管理路由器，那就完美了。所以这个时候，ss 就帮了很大的忙。</p><p>在 pcduino 上面搭建一个 ss 服务，然后想要在外网控制路由器的时候，就使用这个 ss 进行全局代理，肯定能帮你忙咯。</p><p>这个时候，你都能在外网控制自己的路由器了，还有什么鬼干不了？</p><hr><h1 id="第六步，局限"><a href="#第六步，局限" class="headerlink" title="第六步，局限"></a>第六步，局限</h1><p>貌似 80， 8080 之类的端口，都不能访问，被运营商限制了，怕被像我这样的人弄成家里的 vps 挂个 1024 网站，那还得了？</p><hr><h1 id="第七步，免流"><a href="#第七步，免流" class="headerlink" title="第七步，免流"></a>第七步，免流</h1><p>目前来说，都是失败中。</p><hr><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul><li>第一，这是一篇流水账，语文老师教的不好，就这样吧。</li><li>第二，ss 链接的端口，千万不能手贱从路由器去掉绑定了，不然你就回不来内网了。</li><li>第三，允许 ssh 登录，密码一定要设定为复杂密码，不然被爆破了就不好了。</li><li>第四，今天感觉 blog 就是老人机模式，破字体，一直不知道哪个字体最佳。反正 iphone 上面看起来挺不错的。结果，换了 qq.com 的那个。</li></ul></div><nav class="pagination"><a post-prev href="/2017/02/04/wechat_xcx_issue/" title="微信小程序吐槽大会">&#10094; 微信小程序吐槽大会</a> <a post-next href="/2016/04/22/end_of_my_north_drift/" title="那即将逝去的北漂时光">那即将逝去的北漂时光 &#10095;</a></nav></article><section id="comments"><div id="disqus_thread"></div></section></section></section><section site-body class="dn"><nav><a href="/tags/css/" style="font-size:12px;color:#636363">css</a> <a href="/tags/ellipsis/" style="font-size:10px;color:#777">ellipsis</a> <a href="/tags/git/" style="font-size:10px;color:#777">git</a> <a href="/tags/javascript/" style="font-size:16px;color:#3a3a3a">javascript</a> <a href="/tags/life/" style="font-size:10px;color:#777">life</a> <a href="/tags/ppt/" style="font-size:10px;color:#777">ppt</a> <a href="/tags/python/" style="font-size:10px;color:#777">python</a> <a href="/tags/table/" style="font-size:10px;color:#777">table</a> <a href="/tags/warp/" style="font-size:10px;color:#777">warp</a> <a href="/tags/前端/" style="font-size:18px;color:#252525">前端</a> <a href="/tags/技术/" style="font-size:20px;color:#111">技术</a> <a href="/tags/旅游/" style="font-size:14px;color:#4e4e4e">旅游</a> <a href="/tags/生活/" style="font-size:10px;color:#777">生活</a> <a href="/tags/设计/" style="font-size:10px;color:#777">设计</a></nav></section><footer site-footer><div copyright>&copy; 2018 大饼<h4>吾十有五而志于养猪，三十始养，四十亏本，五十再亏，六十亏大了，七十卒，不逾矩。现廿五，将卒。</h4></div><div powered><b>Hexo <a href="https://github.com/shenqihui/hexo-theme-pithy" target="_blank">Pithy</a></b> Theme designed by <b><a href="http://blog.shenqh.com/" target="_blank">shenqihui</a></b>, Powered by <b><a href="http://hexo.io/" target="_blank">Hexo</a></b> and <b><a href="https://pages.github.com/">Github Pages</a></b>. <b><a href="/sitemap.xml">Sitemap</a></b>. <b><a href="/atom.xml">Rss</a></b>.</div><br><div footer_word>我们俩都是年轻人，要将自己献身于伟大事业的开创，我们是天生的魔术师，但我们不会用自己的天赋去伤害任何人。 -- 阿尔弗雷德·波登 《致命魔术》</div></footer><script>setTimeout(function(){var e="shenqihuiblog";!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()},100)</script><script type="text/javascript">!function(e,a,t,n,c,s,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,s=a.createElement(t),o=a.getElementsByTagName(t)[0],s.async=1,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-48454013-1","auto"),ga("require","displayfeatures"),ga("send","pageview")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?a359010dd82707c1ee6d1ca5d64be33b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body>